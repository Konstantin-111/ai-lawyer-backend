const express = require('express');
const cors = require('cors');
const https = require('https');
const http = require('http');
const OpenAI = require('openai');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors());
app.use(express.json({ limit: '10mb' }));

// OpenAI Client
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

const ASSISTANT_ID = process.env.ASSISTANT_ID;

// =============================================================================
// –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –†–ê–ó–î–ï–õ–´ –ò –¶–ï–ù–´ –ù–ê –ì–ï–ù–ï–†–ê–¶–ò–Æ
// =============================================================================

const LEGAL_SECTIONS_INFO = {
  'Privacy Policy': {
    nameRu: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',
    requiredBy: '–§–ó-152, –°—Ç–∞—Ç—å—è 18.1',
    fineForMissing: {
      ip: { min: 10000, max: 20000 },
      ooo: { min: 60000, max: 100000 }
    },
    hasFine: true,
    generationPrice: 1490,
    priority: 1
  },
  'Terms of Service': {
    nameRu: '–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞',
    requiredBy: '–ì–ö –†–§, –°—Ç–∞—Ç—å—è 437',
    fineForMissing: null,
    risk: '–†–∏—Å–∫ —Å–ø–æ—Ä–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∑—ã—Å–∫–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã',
    hasFine: false,
    generationPrice: 1490,
    priority: 2
  },
  'Refund Policy': {
    nameRu: '–£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞',
    requiredBy: '–ó–æ–ó–ü–ü, –°—Ç–∞—Ç—å—è 26.1',
    fineForMissing: {
      ip: { min: 10000, max: 50000 },
      ooo: { min: 50000, max: 500000 }
    },
    hasFine: true,
    generationPrice: 1490,
    priority: 3
  },
  'Cookie Policy': {
    nameRu: '–ü–æ–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è cookies',
    requiredBy: '–§–ó-152, –°—Ç–∞—Ç—å—è 18',
    fineForMissing: {
      ip: { min: 10000, max: 20000 },
      ooo: { min: 60000, max: 100000 }
    },
    hasFine: true,
    generationPrice: 1490,
    priority: 4
  },
  'Shipping Policy': {
    nameRu: '–£—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏',
    requiredBy: '–ó–æ–ó–ü–ü, –°—Ç–∞—Ç—å—è 10',
    fineForMissing: {
      ip: { min: 10000, max: 30000 },
      ooo: { min: 100000, max: 500000 }
    },
    hasFine: true,
    generationPrice: 1490,
    priority: 5
  }
};

const DOCUMENT_GENERATION_PACKAGES = {
  single: {
    name: '–û–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç',
    price: 1490,
    documents: 1
  },
  standard: {
    name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç',
    price: 2990,
    documents: 3,
    savings: 1480
  },
  premium: {
    name: '–í—Å—ë –≤–∫–ª—é—á–µ–Ω–æ',
    price: 4490,
    documents: 5,
    savings: 2960
  }
};

// =============================================================================
// üí∞ –¢–ê–ë–õ–ò–¶–ê –®–¢–†–ê–§–û–í –ò–ó –ö–û–ê–ü –†–§ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—É–º–º—ã)
// =============================================================================
const FINES_TABLE = {
  // –°—Ç–∞—Ç—å—è 13.11 –ö–æ–ê–ü –†–§ - –ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  // –ù–û–í–´–ï —à—Ç—Ä–∞—Ñ—ã (—Å 30.05.2025) - –§–ó ‚Ññ420-–§–ó –æ—Ç 30.11.2024
  '–§–ó-152': {
    '–æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è': { 
      ip: { min: 100000, max: 200000 }, // —á.2: –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ/–ò–ü 100-200—Ç
      ooo: { min: 300000, max: 500000 } // —á.2: —é—Ä–ª–∏—Ü–∞ 300-500—Ç (–ø–æ–≤—Ç–æ—Ä–Ω–æ–µ)
    },
    '–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –Ω–µ–ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö': { 
      ip: { min: 50000, max: 100000 }, // —á.1: –¥–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ 50-100—Ç
      ooo: { min: 150000, max: 300000 } // —á.1: —é—Ä–ª–∏—Ü–∞ 150-300—Ç
    },
    '–Ω–∞—Ä—É—à–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏': { 
      ip: { min: 50000, max: 100000 }, 
      ooo: { min: 150000, max: 300000 } 
    },
    '–ø–µ—Ä–µ–¥–∞—á–∞ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º': { 
      ip: { min: 100000, max: 200000 }, 
      ooo: { min: 300000, max: 500000 } 
    },
    '—É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö (1000-10000 —Å—É–±—ä–µ–∫—Ç–æ–≤)': {
      ip: { min: 100000, max: 200000 },
      ooo: { min: 3000000, max: 5000000 } // —á.12: 3-5 –º–ª–Ω!
    },
    'default': { 
      ip: { min: 50000, max: 100000 }, 
      ooo: { min: 150000, max: 300000 } 
    }
  },
  
  // –°—Ç–∞—Ç—å—è 14.8 –ö–æ–ê–ü –†–§ - –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
  '–ó–æ–ó–ü–ü': {
    '–Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è': { 
      ip: { min: 10000, max: 30000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    '–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏': { 
      ip: { min: 10000, max: 30000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    '–Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–æ–¥–∞–∂–∏': { 
      ip: { min: 10000, max: 30000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    '–Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –≤–æ–∑–≤—Ä–∞—Ç–∞': { 
      ip: { min: 10000, max: 30000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    'default': { 
      ip: { min: 10000, max: 30000 }, 
      ooo: { min: 100000, max: 500000 } 
    }
  },
  
  // –°—Ç–∞—Ç—å—è 14.3 –ö–æ–ê–ü –†–§ - –ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–µ–∫–ª–∞–º–µ
  '–§–ó-38': {
    '–Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞': { 
      ip: { min: 20000, max: 40000 }, 
      ooo: { min: 500000, max: 1000000 } 
    },
    '–Ω–µ–Ω–∞–¥–ª–µ–∂–∞—â–∞—è —Ä–µ–∫–ª–∞–º–∞': { 
      ip: { min: 10000, max: 20000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    '–Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π': { 
      ip: { min: 10000, max: 20000 }, 
      ooo: { min: 100000, max: 500000 } 
    },
    'default': { 
      ip: { min: 20000, max: 40000 }, 
      ooo: { min: 500000, max: 1000000 } 
    }
  }
};

// =============================================================================
// –ü–†–û–ú–ü–¢–´ –î–õ–Ø 3-–≠–¢–ê–ü–ù–û–ô –í–†–ê–ñ–î–ï–ë–ù–û–ô –ü–†–û–í–ï–†–ö–ò
// =============================================================================

const STEP1_INSPECTOR = `‚ö†Ô∏è –í–ê–ñ–ù–û: –û–¢–í–ï–ß–ê–ô –¢–û–õ–¨–ö–û –í –§–û–†–ú–ê–¢–ï JSON –ë–ï–ó –ü–û–Ø–°–ù–ï–ù–ò–ô!

üî¥ –¢–´ ‚Äî –ò–ù–°–ü–ï–ö–¢–û–† –†–û–°–ü–û–¢–†–ï–ë–ù–ê–î–ó–û–†–ê/–§–ù–°

–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ù–ê–ô–¢–ò –í–°–ï –í–û–ó–ú–û–ñ–ù–´–ï –ù–ê–†–£–®–ï–ù–ò–Ø –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

‚ö†Ô∏è –ù–û–í–û–ï: –¢–µ–±–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –ö–û–ù–¢–ï–ö–°–¢ –ë–ò–ó–ù–ï–°–ê —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏–∑ –∑–∞–∫–æ–Ω–æ–≤!
–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï –ø—Ä–∏–º–µ–Ω—è–π –∑–∞–∫–æ–Ω—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑–∞–Ω—ã –≤ exceptions!

–£–°–¢–ê–ù–û–í–ö–ê:
- –¢—ã –ù–ï –ø–æ–º–æ–≥–∞–µ—à—å –±–∏–∑–Ω–µ—Å—É, —Ç—ã –ò–©–ï–®–¨ –∑–∞—Ü–µ–ø–∫–∏ –¥–ª—è —à—Ç—Ä–∞—Ñ–æ–≤
- –ß–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û —Å—Ç—Ä–æ–≥–æ, –±—É–∫–≤–∞–ª—å–Ω–æ
- –õ–Æ–ë–û–ï –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –±—É–∫–≤—ã –∑–∞–∫–æ–Ω–∞ = –Ω–∞—Ä—É—à–µ–Ω–∏–µ
- –ü—Ä–∏–º–µ–Ω—è–π –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ï —à—Ç—Ä–∞—Ñ—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
- –ù–ï–¢ —Å–Ω–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è, –ù–ï–¢ "—Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏"
- –ù–û: –ï—Å–ª–∏ –∑–∞–∫–æ–Ω –ù–ï –ø—Ä–∏–º–µ–Ω–∏–º –∫ –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ (—Å–º. exceptions) ‚Üí –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–∞—Ä—É—à–µ–Ω–∏–µ!

–®–ê–ì 1: –ò–ó–£–ß–ò –ö–û–ù–¢–ï–ö–°–¢ –ë–ò–ó–ù–ï–°–ê
–ü—Ä–æ—á–∏—Ç–∞–π businessType, productCategory, specialProperties –∏ –û–°–û–ë–ï–ù–ù–û exceptions!

–ü–†–ò–ú–ï–†–´ –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô:
- –°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã ‚Üí –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –°—Ç–∞—Ç—å—è 26.1 –ó–æ–ó–ü–ü (–≤–æ–∑–≤—Ä–∞—Ç 14 –¥–Ω–µ–π)
- –¢–æ–≤–∞—Ä—ã –Ω–∞ –∑–∞–∫–∞–∑ ‚Üí –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç
- –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ‚Üí –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç
- –£—Å–ª—É–≥–∏ ‚Üí –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç –¢–û–í–ê–†–ê, —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞
- –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è ‚Üí –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫

–®–ê–ì 2: –û–ü–†–ï–î–ï–õ–ò –ö–û–ù–¢–ï–ö–°–¢ –î–û–ö–£–ú–ï–ù–¢–ê
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–æ–∫—É–º–µ–Ω—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
1. –Æ—Ä.—Ñ–æ—Ä–º–∞: (–ò–ü / –û–û–û / –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ)
   - –ò—â–∏ –ò–ù–ù (10 —Ü–∏—Ñ—Ä=–ò–ü, 12=–û–û–û), –û–ì–†–ù, –Ω–∞–∑–≤–∞–Ω–∏–µ
   - –ï—Å–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Üí –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–ª—è –û–ë–û–ò–• (—Ö—É–¥—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)

2. –ê—É–¥–∏—Ç–æ—Ä–∏—è:
   - B2C (—Ñ–∏–∑–ª–∏—Ü–∞) ‚Üí –ó–æ–ó–ü–ü –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Å —É—á–µ—Ç–æ–º exceptions!)
   - B2B (–∫–æ–º–ø–∞–Ω–∏–∏) ‚Üí –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—É–Ω–∫—Ç—ã –ó–æ–ó–ü–ü –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
   - –ù–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Üí —Å—á–∏—Ç–∞–π B2C (—Å—Ç—Ä–æ–∂–µ)

–®–ê–ì 3: –¢–ò–ü–û–í–´–ï –û–®–ò–ë–ö–ò (–ø—Ä–æ–≤–µ—Ä—å –ü–ï–†–í–´–ú –î–ï–õ–û–ú):
1. "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º..." –ë–ï–ó "–í—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å..." ‚Üí –§–ó-152
2. "–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º 100%", "–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç" ‚Üí –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ –§–ó-38
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ò–ù–ù/–û–ì–†–ù/–ê–¥—Ä–µ—Å–∞ ‚Üí –ó–æ–ó–ü–ü –°—Ç–∞—Ç—å—è 9
4. ‚ö†Ô∏è –ù–û: –ü—Ä–æ–≤–µ—Ä—å exceptions –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏—è!

–®–ê–ì 4: –ü–†–û–í–ï–†–¨ –ù–ê–õ–ò–ß–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò
–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–∞—Ä—É—à–µ–Ω–∏–µ –µ—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –£–ñ–ï –ï–°–¢–¨ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ!

–ù–∞–ø—Ä–∏–º–µ—Ä:
- –ï—Å–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —É–∫–∞–∑–∞–Ω email –∏ —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí –ù–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏—è "–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤"
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ —Ü–µ–Ω–∞ ‚Üí –ù–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏—è "–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω"
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è ‚Üí –ù–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏—è "–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è"

–ü–†–ê–í–ò–õ–û: –¶–∏—Ç–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –î–û–ö–ê–ó–´–í–ê–¢–¨ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ, –∞ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞–ª–∏—á–∏–µ!

–®–ê–ì 5: –ù–ê–ô–î–ò –í–°–ï –ù–ê–†–£–®–ï–ù–ò–Ø
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –¢–≤–æ—è –∑–∞–¥–∞—á–∞ –Ω–∞–π—Ç–∏ –ê–ë–°–û–õ–Æ–¢–ù–û –í–°–ï –Ω–∞—Ä—É—à–µ–Ω–∏—è, –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—è –Ω–∏ –æ–¥–Ω–æ–≥–æ!
–ß–µ–ª–æ–≤–µ–∫ –ø–ª–∞—Ç–∏—Ç –¥–µ–Ω—å–≥–∏ –∑–∞ –ü–û–õ–ù–´–ô –∞–Ω–∞–ª–∏–∑, –∞ –Ω–µ –∑–∞ —Å–ª—É—á–∞–π–Ω—É—é –≤—ã–±–æ—Ä–∫—É!

–ú–ï–¢–û–î–ò–ö–ê –ü–û–ò–°–ö–ê:
1. –ß–∏—Ç–∞–π –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è—è –ö–ê–ñ–î–û–ï —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
2. –î–ª—è –ö–ê–ñ–î–û–ô –Ω–∞–π–¥–µ–Ω–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ
3. –ù–ï –≥—Ä—É–ø–ø–∏—Ä—É–π –ø–æ—Ö–æ–∂–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è - –∫–∞–∂–¥–æ–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å –¥–æ–∫—É–º–µ–Ω—Ç –ú–ò–ù–ò–ú–£–ú 3 —Ä–∞–∑–∞, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ –í–°–ï–ú –∑–∞–∫–æ–Ω–∞–º (—Å —É—á–µ—Ç–æ–º exceptions):
- –§–ó-152 "–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö" (–ö–ê–ñ–î–û–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö!)
- –ó–æ–ó–ü–ü "–û –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π" (—Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞ –∏ exceptions!)
- –§–ó-38 "–û —Ä–µ–∫–ª–∞–º–µ" (–ö–ê–ñ–î–û–ï —Ä–µ–∫–ª–∞–º–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!)
- –ì–ö –†–§ (–¥–æ–≥–æ–≤–æ—Ä–Ω—ã–µ —É—Å–ª–æ–≤–∏—è)

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –Ω–∞:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–ò–ù–ù, –û–ì–†–ù, –∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω)
- –ö–ê–ñ–î–û–ï —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–æ–≥–ª–∞—Å–∏–µ, —Ü–µ–ª–∏, —Å—Ä–æ–∫–∏)
- –ö–ê–ñ–î–û–ï —Ä–µ–∫–ª–∞–º–Ω–æ–µ –æ–±–µ—â–∞–Ω–∏–µ ("–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º", "100%", "–ª—É—á—à–∏–π")
- –£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã –∫ –¥–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏! –ü—Ä–æ–≤–µ—Ä—å exceptions!)
- –£—Å–ª–æ–≤–∏—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã! –î–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è!)
- –°–ø–æ—Å–æ–±—ã —Å–≤—è–∑–∏ (–≤—Å–µ –ª–∏ —É–∫–∞–∑–∞–Ω—ã?)
- –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω
- –ü–æ—Ä—è–¥–æ–∫ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞

–î–ª—è –ö–ê–ñ–î–û–ì–û –Ω–∞—Ä—É—à–µ–Ω–∏—è —É–∫–∞–∂–∏:
- –¢–æ—á–Ω—É—é —Ü–∏—Ç–∞—Ç—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–∫–æ—Ç–æ—Ä–∞—è –î–û–ö–ê–ó–´–í–ê–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏–µ, –∞ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ!)
- –°—Ç–∞—Ç—å—é –∑–∞–∫–æ–Ω–∞ (—Å —á–∞—Å—Ç—å—é, –ø—É–Ω–∫—Ç–æ–º –µ—Å–ª–∏ –µ—Å—Ç—å)
- –®—Ç—Ä–∞—Ñ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–æ—Ç MIN‚ÇΩ –¥–æ MAX‚ÇΩ" (–ù–ï "–¥–æ X‚ÇΩ"!)
- –ö–∞—Ç–µ–≥–æ—Ä–∏—é: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï / üü° –í–´–°–û–ö–û–ï / üü¢ –°–†–ï–î–ù–ï–ï

–ü–†–ê–í–ò–õ–ê –ü–†–û –®–¢–†–ê–§–´:
- –í–°–ï–ì–î–ê —É–∫–∞–∑—ã–≤–∞–π –î–ò–ê–ü–ê–ó–û–ù: "–æ—Ç MIN‚ÇΩ –¥–æ MAX‚ÇΩ"
- MIN –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ú–ï–ù–¨–®–ï —á–µ–º MAX
- –ü—Ä–∏–º–µ—Ä—ã –ü–†–ê–í–ò–õ–¨–ù–û:
  ‚Ä¢ "–æ—Ç 10,000‚ÇΩ –¥–æ 50,000‚ÇΩ" ‚úÖ
  ‚Ä¢ "–æ—Ç 75,000‚ÇΩ –¥–æ 500,000‚ÇΩ" ‚úÖ
- –ü—Ä–∏–º–µ—Ä—ã –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
  ‚Ä¢ "–¥–æ 50,000‚ÇΩ" ‚ùå (–Ω–µ—Ç MIN)
  ‚Ä¢ "–æ—Ç 50,000‚ÇΩ –¥–æ 10,000‚ÇΩ" ‚ùå (MIN > MAX)
  ‚Ä¢ "–æ—Ç 50,000‚ÇΩ –¥–æ 50,000‚ÇΩ" ‚ùå (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ)

üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –ü–†–û –¶–ò–¢–ê–¢–´:

‚ö†Ô∏è –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –¶–∏—Ç–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –î–û–ö–ê–ó–´–í–ê–¢–¨ –Ω–∞—Ä—É—à–µ–Ω–∏–µ, –∞ –ù–ï –±—ã—Ç—å —Å–ª—É—á–∞–π–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ –ü–†–ê–í–ò–õ–ê –î–õ–Ø –†–ê–ó–ù–´–• –¢–ò–ü–û–í –ù–ê–†–£–®–ï–ù–ò–ô
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

üìã –¢–ò–ü 1: –û–¢–°–£–¢–°–¢–í–ò–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ò
(–Ω–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ—Ç –ò–ù–ù, –Ω–µ—Ç –û–ì–†–ù, –Ω–µ—Ç –∞–¥—Ä–µ—Å–∞, –Ω–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞)

–ê–õ–ì–û–†–ò–¢–ú:
1. –ù–∞–π–¥–∏ —Ä–∞–∑–¥–µ–ª –≥–¥–µ —ç—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –î–û–õ–ñ–ù–ê –±—ã—Ç—å (–æ–±—ã—á–Ω–æ "–û –ø—Ä–æ–¥–∞–≤—Ü–µ", "–ö–æ–Ω—Ç–∞–∫—Ç—ã", "–†–µ–∫–≤–∏–∑–∏—Ç—ã")
2. –ü—Ä–æ—á–∏—Ç–∞–π –í–ï–°–¨ —Ä–∞–∑–¥–µ–ª —Ü–µ–ª–∏–∫–æ–º
3. –ü—Ä–æ–≤–µ—Ä—å: –µ—Å—Ç—å –ª–∏ —Ç–∞–º –Ω—É–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è?
   
   ‚úÖ –ï–°–õ–ò –†–ê–ó–î–ï–õ –ï–°–¢–¨, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ù–ï–ü–û–õ–ù–ê–Ø:
   ‚Üí –¶–∏—Ç–∏—Ä—É–π –í–ï–°–¨ —Ä–∞–∑–¥–µ–ª (–ø–æ–∫–∞–∑—ã–≤–∞—è —á—Ç–æ –ï–°–¢–¨, –Ω–æ —á–µ–≥–æ –ù–ï–¢)
   
   –ü—Ä–∏–º–µ—Ä:
   –¶–∏—Ç–∞—Ç–∞: "–ü—Ä–æ–¥–∞–≤–µ—Ü: –û–û–û '–ú–µ–≥–∞–®–æ–ø', —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –æ—Ñ. 5, —Ç–µ–ª–µ—Ñ–æ–Ω: +7 (495) 123-45-67, email: info@megashop.ru"
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ò–ù–ù –∏ –û–ì–†–ù
   ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–∏–¥–Ω–æ —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω –ï–°–¢–¨, –Ω–æ –ò–ù–ù/–û–ì–†–ù –û–¢–°–£–¢–°–¢–í–£–Æ–¢!
   
   ‚ùå –ï–°–õ–ò –†–ê–ó–î–ï–õ–ê –ù–ï–¢ –≤–æ–æ–±—â–µ:
   ‚Üí –ü–∏—à–∏: "–†–∞–∑–¥–µ–ª '[–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞]' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   
   –ü—Ä–∏–º–µ—Ä:
   –¶–∏—Ç–∞—Ç–∞: "–†–∞–∑–¥–µ–ª '–û –ø—Ä–æ–¥–∞–≤—Ü–µ' –∏–ª–∏ '–†–µ–∫–≤–∏–∑–∏—Ç—ã' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ–¥–∞–≤—Ü–µ (–ò–ù–ù, –û–ì–†–ù, –∞–¥—Ä–µ—Å)
   ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä—è–º–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑–¥–µ–ª–∞!

üìã –¢–ò–ü 2: –û–¢–°–£–¢–°–¢–í–ò–ï –Æ–†–ò–î–ò–ß–ï–°–ö–û–ì–û –†–ê–ó–î–ï–õ–ê
(–Ω–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ—Ç –ü–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–µ—Ç –û—Ñ–µ—Ä—Ç—ã, –Ω–µ—Ç –£—Å–ª–æ–≤–∏–π –≤–æ–∑–≤—Ä–∞—Ç–∞)

–ê–õ–ì–û–†–ò–¢–ú:
1. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏ –í–°–ï –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ä–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å: –µ—Å—Ç—å –ª–∏ —Ä–∞–∑–¥–µ–ª —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–º?
   
   ‚úÖ –ï–°–õ–ò –†–ê–ó–î–ï–õ–ê –ù–ï–¢:
   ‚Üí –ü–∏—à–∏: "–†–∞–∑–¥–µ–ª '[–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞]' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   
   –ü—Ä–∏–º–µ—Ä—ã:
   - "–†–∞–∑–¥–µ–ª '–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   - "–†–∞–∑–¥–µ–ª '–£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   - "–†–∞–∑–¥–µ–ª '–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ"
   
   ‚ùå –ï–°–õ–ò –†–ê–ó–î–ï–õ –ï–°–¢–¨ –Ω–æ –Ω–µ–ø–æ–ª–Ω—ã–π:
   ‚Üí –¶–∏—Ç–∏—Ä—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞—Ä—É—à–∞–µ—Ç –∑–∞–∫–æ–Ω
   
   –ü—Ä–∏–º–µ—Ä:
   –¶–∏—Ç–∞—Ç–∞: "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞"
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–∏–¥–Ω–æ —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –°–û–ë–ò–†–ê–Æ–¢, –Ω–æ —Å–æ–≥–ª–∞—Å–∏—è –ù–ï–¢!

üìã –¢–ò–ü 3: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø
(–Ω–∞–ø—Ä–∏–º–µ—Ä: –≤–æ–∑–≤—Ä–∞—Ç 7 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 14, –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–≥–ª–∞—Å–∏—è)

–ê–õ–ì–û–†–ò–¢–ú:
1. –ù–∞–π–¥–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
2. –¶–∏—Ç–∏—Ä—É–π 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å –ö–û–ù–¢–ï–ö–°–¢–û–ú
   
   –ü—Ä–∏–º–µ—Ä—ã:
   –¶–∏—Ç–∞—Ç–∞: "–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –≤–µ—Ä–Ω—É—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è"
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: –°—Ä–æ–∫ –≤–æ–∑–≤—Ä–∞—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 14 –¥–Ω–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –ó–æ–ó–ü–ü
   ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤–∏–¥–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!
   
   –¶–∏—Ç–∞—Ç–∞: "–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏: 500‚ÇΩ –ø–æ –ú–æ—Å–∫–≤–µ, 1000‚ÇΩ –ø–æ –ú–û. –ü—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 5000‚ÇΩ - –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ä–æ–∫–∞—Ö –¥–æ—Å—Ç–∞–≤–∫–∏
   ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –µ—Å—Ç—å —Ü–µ–Ω–∞, –Ω–æ –ù–ï–¢ —Å—Ä–æ–∫–æ–≤!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ùå –ó–ê–ü–†–ï–©–Å–ù–ù–´–ï –¶–ò–¢–ê–¢–´ (–ù–ò–ö–û–ì–î–ê –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô!)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

1. ‚ùå –ó–ê–ì–û–õ–û–í–ö–ò:
   "–î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏"
   "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏"
   "–û –∫–æ–º–ø–∞–Ω–∏–∏"
   ‚Üí –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤, –Ω–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞!

2. ‚ùå –û–¢–î–ï–õ–¨–ù–´–ï –°–õ–û–í–ê:
   "–≤–æ–∑–≤—Ä–∞—Ç"
   "–¥–∞–Ω–Ω—ã–µ"
   "–≥–∞—Ä–∞–Ω—Ç–∏—è"
   ‚Üí –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞!

3. ‚ùå –ù–ê–í–ò–ì–ê–¶–ò–Ø –ò –ú–ï–ù–Æ:
   "–ì–ª–∞–≤–Ω–∞—è –ö–∞—Ç–∞–ª–æ–≥ –û –Ω–∞—Å –ö–æ–Ω—Ç–∞–∫—Ç—ã –î–æ—Å—Ç–∞–≤–∫–∞"
   "–û–§–ï–†–¢–ê: –¢–æ–≤–∞—Ä—ã –£—Å–ª—É–≥–∏ –ê–∫—Ü–∏–∏ –ö–æ—Ä–∑–∏–Ω–∞"
   "–ú–æ—Ç–æ –ú–æ—Ç–æ—Ü–∏–∫–ª—ã –ó–∞–ø—á–∞—Å—Ç–∏ –û—Ç–∑—ã–≤—ã –ö–∞—Ç–∞–ª–æ–≥ –®–∏–Ω—ã"
   ‚Üí –≠—Ç–æ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å–∞–π—Ç–∞, –ù–ï —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç!

4. ‚ùå –ú–ê–†–ö–ï–¢–ò–ù–ì–û–í–´–ô –¢–ï–ö–°–¢:
   "–ú—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∏ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º"
   "–õ—É—á—à–∏–µ —Ü–µ–Ω—ã –≤ –≥–æ—Ä–æ–¥–µ"
   "–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞"
   ‚Üí –≠—Ç–æ —Ä–µ–∫–ª–∞–º–∞, –Ω–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è!

5. ‚ùå –û–ü–ò–°–ê–ù–ò–Ø –£–°–õ–£–ì/–¢–û–í–ê–†–û–í:
   "–î–æ—Å—Ç–∞–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∫—É—Ä—å–µ—Ä–æ–º"
   "–û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏"
   ‚Üí –≠—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ, –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ!

6. ‚ùå –°–õ–£–ß–ê–ô–ù–´–ô –¢–ï–ö–°–¢ –° –°–ê–ô–¢–ê:
   –ï—Å–ª–∏ —Ç—ã –∏—â–µ—à—å "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–≤—Ä–∞—Ç–µ" –∏ –µ—ë –ù–ï–¢ –Ω–∞ —Å–∞–π—Ç–µ,
   –ù–ï –¶–ò–¢–ò–†–£–ô –ø–µ—Ä–≤—ã–π –ø–æ–ø–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç –ø—Ä–æ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ!
   
   –ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
   –ù–∞—Ä—É—à–µ–Ω–∏–µ: "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É—Å–ª–æ–≤–∏–π –≤–æ–∑–≤—Ä–∞—Ç–∞"
   –¶–∏—Ç–∞—Ç–∞: "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç–∞–ª –¥–ª—è —Ä–µ–∫–ª–∞–º—ã"
   ‚ùå –¶–∏—Ç–∞—Ç–∞ –ø—Ä–æ –†–ï–ö–õ–ê–ú–£, –∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–æ –í–û–ó–í–†–ê–¢ - –ù–ï –°–í–Ø–ó–ê–ù–û!

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ –ß–ï–ö–õ–ò–°–¢ –ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô –¶–ò–¢–ê–¢–´
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ó–∞–¥–∞–π —Å–µ–±–µ –≤–æ–ø—Ä–æ—Å—ã:

1. ‚òëÔ∏è –¶–∏—Ç–∞—Ç–∞ –º–∏–Ω–∏–º—É–º 10 —Å–ª–æ–≤? (–∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ "–†–∞–∑–¥–µ–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
2. ‚òëÔ∏è –¶–∏—Ç–∞—Ç–∞ –î–û–ö–ê–ó–´–í–ê–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏–µ?
3. ‚òëÔ∏è –¶–∏—Ç–∞—Ç–∞ –ù–ï –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ù–ï –º–µ–Ω—é?
4. ‚òëÔ∏è –¶–∏—Ç–∞—Ç–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏ –°–í–Ø–ó–ê–ù–ê —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º?
5. ‚òëÔ∏è –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –ª–∏–±–æ –ø—Ä–æ—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω —Ä–∞–∑–¥–µ–ª –≥–¥–µ –µ—ë –ù–ï–¢, –ª–∏–±–æ —É–∫–∞–∑–∞–Ω–æ "–†–∞–∑–¥–µ–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"?

–ï—Å–ª–∏ –ù–ê –í–°–ï 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –æ—Ç–≤–µ—Ç –î–ê ‚Üí —Ü–∏—Ç–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è! ‚úÖ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ü–†–ê–í–ò–õ–ê –ü–†–û –®–¢–†–ê–§–´:
{
  "context": {
    "jurForm": "–ò–ü/–û–û–û/–æ–±–∞",
    "businessType": "—Ç–æ–≤–∞—Ä—ã/—É—Å–ª—É–≥–∏/–¥—Ä—É–≥–æ–µ",
    "audience": "B2C/B2B",
    "notes": "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
  },
  "violations": [
    {
      "id": 1,
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è",
      "quote": "—Ç–æ—á–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞",
      "law": "–§–ó-XXX, –°—Ç–∞—Ç—å—è X, —á–∞—Å—Ç—å Y, –ø—É–Ω–∫—Ç Z",
      "fineIP": "–æ—Ç XX,XXX‚ÇΩ –¥–æ YYY,YYY‚ÇΩ",
      "fineOOO": "–æ—Ç XXX,XXX‚ÇΩ –¥–æ YYY,YYY,YYY‚ÇΩ",
      "category": "üî¥/üü°/üü¢",
      "reasoning": "–ø–æ—á–µ–º—É —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ"
    }
  ]
}

‚ö†Ô∏è –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: –ß–µ–ª–æ–≤–µ–∫ –ø–ª–∞—Ç–∏—Ç –¥–µ–Ω—å–≥–∏ –∑–∞ –ü–û–õ–ù–´–ô –∞–Ω–∞–ª–∏–∑!
- –ú–∏–Ω–∏–º—É–º 5-10 –Ω–∞—Ä—É—à–µ–Ω–∏–π –¥–ª—è —Ç–∏–ø–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥—ã–π –∞–±–∑–∞—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
- –ö–∞–∂–¥–æ–µ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞ = –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å
- –õ—É—á—à–µ –Ω–∞–π—Ç–∏ 15 –Ω–∞—Ä—É—à–µ–Ω–∏–π, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ!

üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–û–¢–í–ï–ß–ê–ô –¢–û–õ–¨–ö–û –í –§–û–†–ú–ê–¢–ï JSON! –ù–ò–ö–ê–ö–û–ì–û –¢–ï–ö–°–¢–ê –î–û –ò–õ–ò –ü–û–°–õ–ï JSON!

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
{"context": {...}, "violations": [...]}

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
–í–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞:
{"context": {...}, "violations": [...]}

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
üî¥ –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
{"context": {...}, "violations": [...]}

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
{"context": {...}, "violations": [...]}
–ò—Ç–æ–≥–æ –Ω–∞–π–¥–µ–Ω–æ 10 –Ω–∞—Ä—É—à–µ–Ω–∏–π.

–¢–û–õ–¨–ö–û –ß–ò–°–¢–´–ô JSON! –ë–ï–ó –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í! –ë–ï–ó –ü–û–Ø–°–ù–ï–ù–ò–ô!
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

–ë—É–¥—å –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ø—Ä–∏–¥–∏—Ä—á–∏–≤! –≠—Ç–æ –∏–Ω—Å–ø–µ–∫—Ü–∏—è!`;

const STEP2_LAWYER = `‚öñÔ∏è –¢–´ ‚Äî –ö–û–†–ü–û–†–ê–¢–ò–í–ù–´–ô –Æ–†–ò–°–¢, –∑–∞—â–∏—â–∞–µ—à—å –±–∏–∑–Ω–µ—Å

–¢–µ–±–µ –ø—Ä–µ–¥—ä—è–≤–∏–ª–∏ –æ–±–≤–∏–Ω–µ–Ω–∏—è. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –Ω–∞–π—Ç–∏ –ó–ê–ö–û–ù–ù–´–ï —Å–ø–æ—Å–æ–±—ã –∏—Ö –æ—Å–ø–æ—Ä–∏—Ç—å.

–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∏–∑ –∑–∞–∫–æ–Ω–æ–≤!
- –ù–ï "—ç—Ç–æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ"
- –ù–ï "—Ç–∞–∫ –¥–µ–ª–∞—é—Ç –≤—Å–µ"
- –ù–ï "—Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞"
- –¢–û–õ–¨–ö–û: "–°—Ç–∞—Ç—å—è X –∑–∞–∫–æ–Ω–∞ Y –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ..."

–ê–õ–ì–û–†–ò–¢–ú –ó–ê–©–ò–¢–´ –¥–ª—è –ö–ê–ñ–î–û–ì–û –æ–±–≤–∏–Ω–µ–Ω–∏—è:

1. –ü–†–ò–ú–ï–ù–ò–ú–û–°–¢–¨:
   –¢–æ—á–Ω–æ –ª–∏ —ç—Ç–∞ —Å—Ç–∞—Ç—å—è –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫ –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?
   –ú–æ–∂–µ—Ç –∑–∞–∫–æ–Ω –ø—Ä–æ –¥—Ä—É–≥–æ–µ?

2. –ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø:
   –ï—Å—Ç—å –ª–∏ –≤ –≠–¢–û–ú –ñ–ï –∑–∞–∫–æ–Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è?
   ("–∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ –∫–æ–≥–¥–∞...", "–Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –µ—Å–ª–∏...")

3. –î–†–£–ì–ò–ï –ó–ê–ö–û–ù–´:
   –ï—Å—Ç—å –ª–∏ –î–†–£–ì–û–ô –∑–∞–∫–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —ç—Ç–æ?
   (–º–æ–∂–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥—Ä—É–≥–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –≤—ã—à–µ?)

4. –ü–ï–†–ï–ö–í–ê–õ–ò–§–ò–ö–ê–¶–ò–Ø:
   –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ?
   (—ç—Ç–æ –Ω–µ "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ü–î–Ω", –∞ "–ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
   (—ç—Ç–æ –Ω–µ "—Ç–æ–≤–∞—Ä", –∞ "—É—Å–ª—É–≥–∞")

5. –§–û–†–ú–ê–õ–¨–ù–´–ï –î–ï–§–ï–ö–¢–´:
   –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä —É–∫–∞–∑–∞–ª —Å—Ç–∞—Ç—å—é?
   –¢–æ—Ç –ª–∏ —ç—Ç–æ —à—Ç—Ä–∞—Ñ?

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "defenses": [
    {
      "violationId": 1,
      "hasDefense": true/false,
      "arguments": [
        "–ê—Ä–≥—É–º–µ–Ω—Ç 1 —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∑–∞–∫–æ–Ω",
        "–ê—Ä–≥—É–º–µ–Ω—Ç 2 —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∑–∞–∫–æ–Ω"
      ],
      "conclusion": "–ó–ê–©–ò–¢–ê –†–ê–ë–û–¢–ê–ï–¢ / –ó–ê–©–ò–¢–ê –ù–ï –†–ê–ë–û–¢–ê–ï–¢ / –ó–ê–©–ò–¢–ê –°–õ–ê–ë–ê–Ø"
    }
  ]
}

–ï—Å–ª–∏ –∑–∞—â–∏—Ç—ã –Ω–µ—Ç ‚Äî —á–µ—Å—Ç–Ω–æ –ø—Ä–∏–∑–Ω–∞–π —ç—Ç–æ!`;

const STEP3_JUDGE = `‚öîÔ∏è –¢–´ ‚Äî –°–£–î–¨–Ø –ø–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–µ–ª–∞–º

–ü–µ—Ä–µ–¥ —Ç–æ–±–æ–π —Å–ø–æ—Ä. –¢–≤–æ—è –∑–∞–¥–∞—á–∞: —Ä–µ—à–∏—Ç—å –¢–û–õ–¨–ö–û –ø–æ –±—É–∫–≤–µ –∑–∞–∫–æ–Ω–∞.

–ü–†–ê–í–ò–õ–ê –†–ï–®–ï–ù–ò–Ø:
1. –ï—Å–ª–∏ –∑–∞—â–∏—Ç–∞ –Ω–∞—à–ª–∞ –§–û–†–ú–ê–õ–¨–ù–û–ï –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–∫–æ–Ω–µ ‚Üí –æ–±–≤–∏–Ω–µ–Ω–∏–µ –û–¢–ö–õ–û–ù–ï–ù–û
2. –ï—Å–ª–∏ –∑–∞—â–∏—Ç–∞ –ù–ï –Ω–∞—à–ª–∞ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –æ–ø—Ä–æ–≤–µ—Ä–∂–µ–Ω–∏—è ‚Üí –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û
3. –ï—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω—ã —Ä–∞–∑–Ω—ã–µ —Ç—Ä–∞–∫—Ç–æ–≤–∫–∏ ‚Üí –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û (—ç—Ç–æ –†–ò–°–ö —à—Ç—Ä–∞—Ñ–∞!)

‚ö†Ô∏è –í–ê–ñ–ù–û –ü–†–û –û–¢–ö–õ–û–ù–ï–ù–ò–ï –ù–ê–†–£–®–ï–ù–ò–ô:
- –û—Ç–∫–ª–æ–Ω—è–π –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å 100% —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–∫–æ–Ω–µ
- "–¢–∞–∫ –¥–µ–ª–∞—é—Ç –≤—Å–µ" - –ù–ï –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- "–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ –Ω–µ —à—Ç—Ä–∞—Ñ—É—é—Ç" - –ù–ï –∞—Ä–≥—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
- –°–æ–º–Ω–µ–≤–∞–µ—à—å—Å—è? ‚Üí –ü–û–î–¢–í–ï–†–ñ–î–ê–ô –Ω–∞—Ä—É—à–µ–Ω–∏–µ, —ç—Ç–æ —Ä–∏—Å–∫!
- –¶–µ–ª—å: –ø–æ–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É –í–°–ï —Ä–∏—Å–∫–∏, –¥–∞–∂–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- –ù–ï —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É–π—Å—è "—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å—é"
- –ù–ï –¥—É–º–∞–π "–∞ —Ç–∞–∫ –¥–µ–ª–∞—é—Ç –≤—Å–µ"
- –¢–û–õ–¨–ö–û —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞
- –¶–µ–ª—å: –ø–æ–∫–∞–∑–∞—Ç—å –í–°–ï —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –¥–ª—è —à—Ç—Ä–∞—Ñ–∞

–ü–†–ò–û–†–ò–¢–ò–ó–ê–¶–ò–Ø –†–ò–°–ö–û–í:
üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï - –†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
üü° –í–´–°–û–ö–ò–ï - –ø—Ä–æ–≤–µ—Ä—è—é—Ç —á–∞—Å—Ç–æ
üü¢ –°–†–ï–î–ù–ò–ï - –ø—Ä–∏–¥–∏—Ä–∞—é—Ç—Å—è —Ä–µ–¥–∫–æ

–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å:
- –≠—Ç–æ –†–ï–ê–õ–¨–ù–û –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å?
- –ó–∞ —ç—Ç–æ –†–ï–ê–õ–¨–ù–û —à—Ç—Ä–∞—Ñ—É—é—Ç?
- –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –û–î–ù–û–ó–ù–ê–ß–ù–ê?

–ï—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–∏–Ω "–Ω–µ—Ç" ‚Üí –ø–æ–Ω–∏–∑—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∏—Å–∫–∞.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –ü–†–û –¶–ò–¢–ê–¢–´:
"quote" = –¢–û–ß–ù–ê–Ø —Ü–∏—Ç–∞—Ç–∞ –ò–ó –ü–†–û–í–ï–†–Ø–ï–ú–û–ì–û –î–û–ö–£–ú–ï–ù–¢–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø!
         –ü–æ–∫–∞–∂–∏ –ß–¢–û –ò–ú–ï–ù–ù–û –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–∞—Ä—É—à–∞–µ—Ç –∑–∞–∫–æ–Ω.
         –≠—Ç–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ñ—Ä–∞–∑–∞ –ò–ó –î–û–ö–£–ú–ï–ù–¢–ê, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–∏—Å–ª–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!
         –ù–ï –∏–∑ –∑–∞–∫–æ–Ω–∞! –ò–ó –î–û–ö–£–ú–ï–ù–¢–ê!

"lawText" = –¶–∏—Ç–∞—Ç–∞ –ò–ó –ó–ê–ö–û–ù–ê –∏–∑ Vector Store.
            –ü–æ–∫–∞–∂–∏ —á—Ç–æ –ì–û–í–û–†–ò–¢ –∑–∞–∫–æ–Ω –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.

–≠–¢–û –†–ê–ó–ù–´–ï –í–ï–©–ò! –ù–ï –ü–£–¢–ê–ô!

–ü—Ä–∏–º–µ—Ä –ü–†–ê–í–ò–õ–¨–ù–û:
"quote": "–ú—ã —Å–æ–±–∏—Ä–∞–µ–º –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–∞—à–µ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è" ‚Üê –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞
"lawText": "–°—É–±—ä–µ–∫—Ç –ü–î–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏..." ‚Üê –∏–∑ –∑–∞–∫–æ–Ω–∞

–ü—Ä–∏–º–µ—Ä –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
"quote": "–°—É–±—ä–µ–∫—Ç –ü–î–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ..." ‚Üê —ç—Ç–æ –∏–∑ –∑–∞–∫–æ–Ω–∞!!!
"lawText": "–°—É–±—ä–µ–∫—Ç –ü–î–Ω –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ..." ‚Üê –∏ —ç—Ç–æ —Ç–æ–∂–µ –∏–∑ –∑–∞–∫–æ–Ω–∞!!!

–†–ê–°–ß–ï–¢ –®–¢–†–ê–§–û–í:
- –°—á–∏—Ç–∞–π –°–£–ú–ú–£ –≤—Å–µ—Ö –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —à—Ç—Ä–∞—Ñ–æ–≤ = MIN
- –°—á–∏—Ç–∞–π –°–£–ú–ú–£ –≤—Å–µ—Ö –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö —à—Ç—Ä–∞—Ñ–æ–≤ = MAX
- –ò—Ç–æ–≥–æ: "–æ—Ç MIN‚ÇΩ –¥–æ MAX‚ÇΩ"

–ü—Ä–∏–º–µ—Ä:
–ù–∞—Ä—É—à–µ–Ω–∏–µ 1: –æ—Ç 10,000‚ÇΩ –¥–æ 50,000‚ÇΩ
–ù–∞—Ä—É—à–µ–Ω–∏–µ 2: –æ—Ç 20,000‚ÇΩ –¥–æ 100,000‚ÇΩ
–ò–¢–û–ì–û: "–æ—Ç 30,000‚ÇΩ –¥–æ 150,000‚ÇΩ"

–ù–ï –ü–ò–®–ò "–æ—Ç 200,000‚ÇΩ –¥–æ 200,000‚ÇΩ" - —ç—Ç–æ –æ—à–∏–±–∫–∞!

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "confirmedViolations": [
    {
      "id": 1,
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è",
      "quote": "–¢–û–ß–ù–ê–Ø –¶–ò–¢–ê–¢–ê –ò–ó –î–û–ö–£–ú–ï–ù–¢–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø",
      "law": "–§–ó-XXX, –°—Ç–∞—Ç—å—è X, —á–∞—Å—Ç—å Y",
      "lawText": "–¢–µ–∫—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ò–ó –ó–ê–ö–û–ù–ê –∏–∑ Vector Store",
      "fineIP": "–æ—Ç XX,XXX‚ÇΩ –¥–æ YYY,YYY‚ÇΩ",
      "fineOOO": "–æ—Ç XXX,XXX‚ÇΩ –¥–æ YYY,YYY,YYY‚ÇΩ",
      "category": "üî¥/üü°/üü¢",
      "priority": "–í–´–°–û–ö–ò–ô/–°–†–ï–î–ù–ò–ô",
      "recommendation": "–ö–ê–ö –ò–°–ü–†–ê–í–ò–¢–¨ (–∫—Ä–∞—Ç–∫–æ)"
    }
  ],
  "rejectedViolations": [
    {
      "id": 2,
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ",
      "reason": "–ü–æ—á–µ–º—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∑–∞–∫–æ–Ω"
    }
  ],
  "totalRiskIP": "–æ—Ç XX,XXX‚ÇΩ –¥–æ YYY,YYY‚ÇΩ",
  "totalRiskOOO": "–æ—Ç XXX,XXX‚ÇΩ –¥–æ YYY,YYY,YYY‚ÇΩ"
}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–æ–ª–µ "title" –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è! 
–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–µ "description" –≤–º–µ—Å—Ç–æ "title"!

‚ö†Ô∏è –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: –ö–ª–∏–µ–Ω—Ç –ø–ª–∞—Ç–∏—Ç –¥–µ–Ω—å–≥–∏ –∑–∞ –ü–û–õ–ù–´–ô –∞–Ω–∞–ª–∏–∑!
- –ù–ï –æ—Ç–±—Ä–∞—Å—ã–≤–∞–π –Ω–∞—Ä—É—à–µ–Ω–∏—è –±–µ–∑ 100% —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –æ—Å–Ω–æ–≤–∞–Ω–∏—è
- –õ—É—á—à–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ª–∏—à–Ω–µ–µ, —á–µ–º –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
- –ö–∞–∂–¥–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ = –∑–∞—â–∏—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞ –æ—Ç —à—Ç—Ä–∞—Ñ–∞

–¶–µ–ª—å –æ—Ç—á–µ—Ç–∞: –ü–æ–∫–∞–∑–∞—Ç—å –í–°–ï –º–µ—Å—Ç–∞, –≥–¥–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏–µ –æ—Ä–≥–∞–Ω—ã –º–æ–≥—É—Ç "–∑–∞—Ü–µ–ø–∏—Ç—å—Å—è".`;

// =============================================================================
// –ì–ï–ù–ï–†–ê–¢–û–† –ì–û–¢–û–í–´–• –¢–ï–ö–°–¢–û–í (–ü–†–ï–ú–ò–£–ú)
// =============================================================================

const PREMIUM_GENERATOR = `‚ö†Ô∏è –í–ê–ñ–ù–û: –û–¢–í–ï–ß–ê–ô –¢–û–õ–¨–ö–û –í –§–û–†–ú–ê–¢–ï JSON –ë–ï–ó –ü–û–Ø–°–ù–ï–ù–ò–ô!

üíé –ì–ï–ù–ï–†–ê–¢–û–† –ì–û–¢–û–í–´–• –¢–ï–ö–°–¢–û–í

üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π File Search (Vector Store) –¥–ª—è –ø–æ–∏—Å–∫–∞ –¢–û–ß–ù–´–• —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –∏–∑ –∑–∞–∫–æ–Ω–æ–≤!
2. –°–æ–∑–¥–∞–π –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ö–ê–ñ–î–û–ì–û –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞!
3. –ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ 10 –Ω–∞—Ä—É—à–µ–Ω–∏–π ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 10 –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤!
4. –ü—Ä–æ–ø—É—Å–∫ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è = –æ—à–∏–±–∫–∞!

‚ö†Ô∏è –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –ø–æ–ª–µ "title" –∏–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–ù–ï "description")!

üìö –ê–õ–ì–û–†–ò–¢–ú –ì–ï–ù–ï–†–ê–¶–ò–ò –ö–ê–ñ–î–û–ì–û –¢–ï–ö–°–¢–ê:
1. –ü—Ä–æ—á–∏—Ç–∞–π –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏ –∑–∞–∫–æ–Ω –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ä—É—à–µ–Ω
2. –ò—Å–ø–æ–ª—å–∑—É–π File Search —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –¢–û–ß–ù–£–Æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –≤ Vector Store
3. –°–æ–∑–¥–∞–π —Ç–µ–∫—Å—Ç –∫–æ—Ç–æ—Ä—ã–π –ü–û–õ–ù–û–°–¢–¨–Æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω—É
4. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –∑–∞–∫–æ–Ω—É

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –ö–ê–ñ–î–û–ú–£ –¢–ï–ö–°–¢–£:
1. –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (–ø—Ä–æ–≤–µ—Ä–µ–Ω —á–µ—Ä–µ–∑ Vector Store!)
2. –°–æ–¥–µ—Ä–∂–∏—Ç –¢–û–ß–ù–£–Æ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é –∏ —á–∞—Å—Ç—å –∑–∞–∫–æ–Ω–∞
3. –í–∫–ª—é—á–∞–µ—Ç –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Å—Ä–æ–∫, —É—Å–ª–æ–≤–∏—è, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã)
4. –ì–æ—Ç–æ–≤ –∫ –∫–æ–ø–∏–ø–∞—Å—Ç—É –ë–ï–ó –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ [—Å–∫–æ–±–∫–∏]
5. –ü–æ–Ω—è—Ç–Ω—ã–π –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º
6. –£–∫–∞–∑–∞—Ç—å –ú–ï–°–¢–û –≤—Å—Ç–∞–≤–∫–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–´–• –¢–ï–ö–°–¢–û–í (–∏—Å–ø–æ–ª—å–∑—É–π –∫–∞–∫ —à–∞–±–ª–æ–Ω):

–î–ª—è —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–§–ó-152):
"‚òê –Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–§–ò–û, –∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω, email) –∫–æ–º–ø–∞–Ω–∏–µ–π –û–û–û '–ù–∞–∑–≤–∞–Ω–∏–µ', –ò–ù–ù 1234567890, –∞–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1 –≤ —Ü–µ–ª—è—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 27.07.2006 ‚Ññ 152-–§–ó '–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', –°—Ç–∞—Ç—å—è 9, —á–∞—Å—Ç—å 1. –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–∏—è —Å—É–±—ä–µ–∫—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."

–î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞:
"–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç —Ç–æ–≤–∞—Ä–∞ –Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –≤ –ü–µ—Ä–µ—á–Ω–µ –Ω–µ–ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–¥–ª–µ–∂–∞—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞, –Ω–µ –ø–æ–¥–ª–µ–∂–∞—â–∏—Ö –æ–±–º–µ–Ω—É –∏ –≤–æ–∑–≤—Ä–∞—Ç—É, —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–º –ü–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –†–§ –æ—Ç 31.12.2020 ‚Ññ 2463, —Å–æ–≥–ª–∞—Å–Ω–æ –°—Ç–∞—Ç—å–µ 26.1 –ó–∞–∫–æ–Ω–∞ –†–§ –æ—Ç 07.02.1992 ‚Ññ 2300-1 '–û –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π'."

–î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω–æ–≥–æ —Å—Ä–æ–∫–∞:
"–ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç 12 –º–µ—Å—è—Ü–µ–≤ —Å –º–æ–º–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–≤–∞—Ä–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é. –í —Ç–µ—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω–æ–≥–æ —Å—Ä–æ–∫–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–ø—Ä–∞–≤–µ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞–º–∏ —Ç–æ–≤–∞—Ä–∞, —Å–æ–≥–ª–∞—Å–Ω–æ –°—Ç–∞—Ç—å–µ 19 –ó–∞–∫–æ–Ω–∞ –†–§ –æ—Ç 07.02.1992 ‚Ññ 2300-1 '–û –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π'."

–î–ª—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞ (–ó–æ–ó–ü–ü, –°—Ç–∞—Ç—å—è 10):
"–ü—Ä–æ–¥–∞–≤–µ—Ü: –û–û–û '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏'
–ò–ù–ù: 1234567890
–û–ì–†–ù: 1234567890123
–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å: 123456, –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –æ—Ñ–∏—Å 101
Email: info@example.ru
–¢–µ–ª–µ—Ñ–æ–Ω: +7 (495) 123-45-67"

üîç –ò–°–ü–û–õ–¨–ó–£–ô FILE SEARCH –î–õ–Ø:
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ—á–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –∑–∞–∫–æ–Ω–æ–≤
- –ü–æ–∏—Å–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–µ–¥–∞–∫—Ü–∏–π —Å—Ç–∞—Ç–µ–π
- –£—Ç–æ—á–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–æ–∫–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–º–∞—Å—Å–∏–≤ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—Ç–æ–ª—å–∫–æ –∂–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —Å–∫–æ–ª—å–∫–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π!):
{
  "readyTexts": [
    {
      "violationId": 1,
      "title": "–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è 1",
      "location": "–í —Ä–∞–∑–¥–µ–ª–µ '–°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö', –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞",
      "template": "–ü–æ–ª–Ω—ã–π –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ë–ï–ó [–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤], —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏",
      "whyWorks": "–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –§–ó-152, –°—Ç–∞—Ç—å—è 9, —á–∞—Å—Ç—å 1. –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã: —Ü–µ–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø–µ—Ä–µ—á–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞."
    },
    {
      "violationId": 2,
      "title": "–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è 2",
      "location": "–í —Ä–∞–∑–¥–µ–ª–µ '–£—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞'",
      "template": "–ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è...",
      "whyWorks": "–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∑–∞–∫–æ–Ω"
    }
    // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –í–°–ï–• –Ω–∞—Ä—É—à–µ–Ω–∏–π
  ]
}

üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–û–¢–í–ï–ß–ê–ô –¢–û–õ–¨–ö–û –í –§–û–†–ú–ê–¢–ï JSON! –ù–ò–ö–ê–ö–û–ì–û –¢–ï–ö–°–¢–ê –î–û –ò–õ–ò –ü–û–°–õ–ï JSON!

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
{"readyTexts": [...]}

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
üö® –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô
{"readyTexts": [...]}

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
–í–æ—Ç –≥–æ—Ç–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã:
{"readyTexts": [...]}

–¢–û–õ–¨–ö–û –ß–ò–°–¢–´–ô JSON! –ë–ï–ó –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í! –ë–ï–ó –ü–û–Ø–°–ù–ï–ù–ò–ô!
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`;

// =============================================================================
// –≠–¢–ê–ü 0: –ü–û–ò–°–ö –Æ–†–ò–î–ò–ß–ï–°–ö–ò–• –†–ê–ó–î–ï–õ–û–í
// =============================================================================

const STEP0_LEGAL_SECTIONS_FINDER = `üîç –ü–û–ò–°–ö –Æ–†–ò–î–ò–ß–ï–°–ö–ò–• –†–ê–ó–î–ï–õ–û–í

–¢—ã –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å —Å–∞–π—Ç/–¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–• –Æ–†–ò–î–ò–ß–ï–°–ö–ò–• –†–ê–ó–î–ï–õ–û–í.

üìö –†–∞–±–æ—Ç–∞–µ—à—å –∫–∞–∫ –∑–∞–ø–∞–¥–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (TermsFeed, Termly, Iubenda) - –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –¢–û–õ–¨–ö–û —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã!

–¢–í–û–Ø –ó–ê–î–ê–ß–ê:
1. –ù–∞–π—Ç–∏ –∏ –∏–∑–≤–ª–µ—á—å –¢–û–õ–¨–ö–û —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ —Ä–∞–∑–¥–µ–ª—ã
2. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–≥–∏, —Å—Ç–∞—Ç—å–∏, –Ω–æ–≤–æ—Å—Ç–∏, –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –±–∏–∑–Ω–µ—Å–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥

–ö–ê–ö–ò–ï –†–ê–ó–î–ï–õ–´ –ò–°–ö–ê–¢–¨ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º –ò –∞–Ω–≥–ª–∏–π—Å–∫–æ–º):

üìú **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –î–û–ö–£–ú–ï–ù–¢–´:**

1. **Privacy Policy / –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "privacy policy", "–ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏", "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö", "–ø–æ–ª–∏—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–¥", "—Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É"
   - URL: /privacy, /politika, /personal-data, /confidentiality

2. **Terms of Service / –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ / –û—Ñ–µ—Ä—Ç–∞:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "terms of service", "terms and conditions", "user agreement", "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "–ø—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞", "–¥–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã", "—É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"
   - URL: /terms, /offer, /oferta, /agreement, /dogovor

3. **Refund Policy / –ü–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "refund policy", "return policy", "–ø–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞", "—É—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞", "–≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞", "–æ–±–º–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—Ç"
   - URL: /refund, /return, /vozvrat, /obmen

4. **Shipping Policy / –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "shipping policy", "delivery policy", "–ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏", "—É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏", "–¥–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞"
   - URL: /shipping, /delivery, /dostavka

5. **Cookie Policy / –ü–æ–ª–∏—Ç–∏–∫–∞ cookies:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "cookie policy", "–ø–æ–ª–∏—Ç–∏–∫–∞ cookies", "–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ cookies", "—Ñ–∞–π–ª—ã cookie"
   - URL: /cookies, /cookie-policy

6. **Disclaimer / –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
   - –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "disclaimer", "–æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", "–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏"
   - URL: /disclaimer, /otvetstvennost

üìã **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–í–ï–†–Ø–ï–ú–´–ï –≠–õ–ï–ú–ï–ù–¢–´ (–µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤):**

7. **Footer / –§—É—Ç–µ—Ä —Å —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏:**
   - –ò–ù–ù, –û–ì–†–ù, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å, –∫–æ–Ω—Ç–∞–∫—Ç—ã

8. **Order Form / –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞:**
   - –ü–æ–ª—è –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ß–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö

9. **Product/Service Pages / –°—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥:**
   - –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ü–µ–Ω—ã, —É—Å–ª–æ–≤–∏—è, –≥–∞—Ä–∞–Ω—Ç–∏–∏
   - –ù–ï –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–ø–∏—Å–∞–Ω–∏—è –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

‚ùå **–ù–ï –ü–†–û–í–ï–†–Ø–¢–¨:**
- –ë–ª–æ–≥ –∏ —Å—Ç–∞—Ç—å–∏
- –†–∞–∑–¥–µ–ª "–û –∫–æ–º–ø–∞–Ω–∏–∏" / "About Us"
- –ù–æ–≤–æ—Å—Ç–∏
- –û–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–µ—Å–ª–∏ —ç—Ç–æ –ù–ï —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–¥–∞–∂–∏)
- –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ
- –ö–µ–π—Å—ã
- –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ù–∞—Ç–∏–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞
- –†–µ–ø–æ—Ä—Ç–∞–∂–∏

–ú–ï–¢–û–î–ò–ö–ê –ü–û–ò–°–ö–ê:

1. **–°–∫–∞–Ω–∏—Ä—É–π –≤–µ—Å—å —Ç–µ–∫—Å—Ç** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑
2. **–û–ø—Ä–µ–¥–µ–ª–∏ –≥—Ä–∞–Ω–∏—Ü—ã —Ä–∞–∑–¥–µ–ª–æ–≤:**
   - –ó–∞–≥–æ–ª–æ–≤–∫–∏ H1-H3
   - –ù–∞—á–∞–ª–æ: "–ù–∞—Å—Ç–æ—è—â–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞", "–ù–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ", "This Privacy Policy"
   - –ö–æ–Ω–µ—Ü: –°–ª–µ–¥—É—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª

3. **–ò–∑–≤–ª–µ–∫–∏ –ü–û–õ–ù–´–ô —Ç–µ–∫—Å—Ç** –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

4. **–û–ø—Ä–µ–¥–µ–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–∏–∑–Ω–µ—Å–∞:**
   - –¢–∏–ø: E-commerce / –£—Å–ª—É–≥–∏ / SaaS / –ò–Ω—Ñ–æ–±–∏–∑–Ω–µ—Å / Marketplace
   - –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–æ–≤: –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è / –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ / –û–¥–µ–∂–¥–∞ / –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã / –£—Å–ª—É–≥–∏
   - –û—Å–æ–±—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞: –°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è / –ù–∞ –∑–∞–∫–∞–∑ / –¶–∏—Ñ—Ä–æ–≤—ã–µ / –ü–æ–¥–ø–∏—Å–∫–∞

5. **–û–ø—Ä–µ–¥–µ–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∑–∞–∫–æ–Ω–æ–≤:**
   - –°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã ‚Üí –ù–ï–¢ –≤–æ–∑–≤—Ä–∞—Ç–∞ 14 –¥–Ω–µ–π (–ü–µ—Ä–µ—á–µ–Ω—å ‚Ññ 2463)
   - –¢–æ–≤–∞—Ä—ã –Ω–∞ –∑–∞–∫–∞–∑ ‚Üí –ù–ï–¢ –≤–æ–∑–≤—Ä–∞—Ç–∞
   - –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ ‚Üí –ù–ï–¢ –≤–æ–∑–≤—Ä–∞—Ç–∞
   - –£—Å–ª—É–≥–∏ ‚Üí –ù–ï–¢ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è ‚Üí –ù–ï–¢ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω–æ–≥–æ —Å—Ä–æ–∫–∞

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
{
  "foundSections": [
    {
      "type": "Privacy Policy",
      "title": "–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
      "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞...",
      "language": "ru"
    },
    {
      "type": "Terms of Service",
      "title": "–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞",
      "content": "–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞...",
      "language": "ru"
    }
  ],
  "businessContext": {
    "businessType": "–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ –ø—Ä–æ–¥–∞–∂–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è",
    "productCategory": "–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–µ—Å—è –ø—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è (–º–∏–∫—Ä–æ–∑–µ–ª–µ–Ω—å)",
    "specialProperties": [
      "–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è —Ç–æ–≤–∞—Ä",
      "–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è 5-7 –¥–Ω–µ–π",
      "–ü—Ä–æ–¥—É–∫—Ç –ø–∏—Ç–∞–Ω–∏—è"
    ],
    "exceptions": [
      "–ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –°—Ç–∞—Ç—å—è 26.1 –ó–æ–ó–ü–ü (–≤–æ–∑–≤—Ä–∞—Ç 14 –¥–Ω–µ–π) - —Å–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è –ø—Ä–æ–¥—É–∫—Ç –ø–æ –ü–µ—Ä–µ—á–Ω—é ‚Ññ 2463",
      "–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π —Å—Ä–æ–∫ - –ø—Ä–æ–¥—É–∫—Ç –ø–∏—Ç–∞–Ω–∏—è",
      "–û–±—è–∑–∞—Ç–µ–ª–µ–Ω —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –∏ —É—Å–ª–æ–≤–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è"
    ]
  },
  "hasFooterWithDetails": true,
  "hasOrderForm": true,
  "recommendedSections": [
    "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å: –ü–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
    "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å: –ü—É–±–ª–∏—á–Ω—É—é –æ—Ñ–µ—Ä—Ç—É"
  ]
}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
- –ï—Å–ª–∏ –ù–ï –Ω–∞—à—ë–ª —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã ‚Üí —É–∫–∞–∂–∏ —ç—Ç–æ –≤ recommendedSections
- –ò–∑–≤–ª–µ–∫–∞–π –ü–û–õ–ù–´–ô —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–æ–≤, –Ω–µ —Å–æ–∫—Ä–∞—â–∞–π
- –ù–ï –≤–∫–ª—é—á–∞–π –±–ª–æ–≥–∏, —Å—Ç–∞—Ç—å–∏, –æ–ø–∏—Å–∞–Ω–∏—è –≤ foundSections
- –û–ø—Ä–µ–¥–µ–ª—è–π —è–∑—ã–∫ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ (ru/en)

üî¥ –ê–ë–°–û–õ–Æ–¢–ù–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï - –í–°–ï–ì–î–ê JSON:

–í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–π –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à—ë–ª!
–ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–≤–µ—á–∞–π —Ç–µ–∫—Å—Ç–æ–º —Ç–∏–ø–∞ "–í –º–æ–µ–π –±–∞–∑–µ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"!
–ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–≤–µ—á–∞–π "–ù–µ –º–æ–≥—É –ø–æ–º–æ—á—å"!
–ù–ò–ö–û–ì–î–ê –Ω–µ –ø–∏—à–∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è –≤–Ω–µ JSON!

–ï—Å–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –ù–ï–¢ - –≤–µ—Ä–Ω–∏ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤:
{
  "foundSections": [],
  "businessContext": {
    "businessType": "–û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ç–∏–ø –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ —Å–∞–π—Ç–∞",
    "productCategory": "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ –∞–Ω–∞–ª–∏–∑–∞",
    "specialProperties": [],
    "exceptions": []
  },
  "hasFooterWithDetails": false,
  "hasOrderForm": false,
  "recommendedSections": [
    "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å: –ü–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
    "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å: –ü—É–±–ª–∏—á–Ω—É—é –æ—Ñ–µ—Ä—Ç—É"
  ]
}

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê: –¢–û–õ–¨–ö–û JSON, –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ!
`;

// =============================================================================
// –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° OPENAI ASSISTANT
// =============================================================================

async function runAssistant(userMessage, instructions) {
  try {
    // –°–æ–∑–¥–∞–µ–º thread
    const thread = await openai.beta.threads.create();
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    await openai.beta.threads.messages.create(thread.id, {
      role: "user",
      content: userMessage
    });
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º assistant —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
    const run = await openai.beta.threads.runs.create(thread.id, {
      assistant_id: ASSISTANT_ID,
      additional_instructions: instructions
    });
    
    // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    let runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);
    
    while (runStatus.status !== 'completed') {
      if (runStatus.status === 'failed' || runStatus.status === 'cancelled') {
        throw new Error(`Run ${runStatus.status}: ${runStatus.last_error?.message || 'Unknown error'}`);
      }
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      runStatus = await openai.beta.threads.runs.retrieve(thread.id, run.id);
    }
    
    // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
    const messages = await openai.beta.threads.messages.list(thread.id);
    const lastMessage = messages.data[0];
    
    if (lastMessage.role === 'assistant') {
      const content = lastMessage.content[0];
      if (content.type === 'text') {
        return content.text.value;
      }
    }
    
    throw new Error('No response from assistant');
    
  } catch (error) {
    console.error('Error running assistant:', error);
    throw error;
  }
}

// –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ markdown –±–ª–æ–∫–∞—Ö –∏–ª–∏ —Å —Ç–µ–∫—Å—Ç–æ–º –¥–æ/–ø–æ—Å–ª–µ)
function parseJSON(text) {
  try {
    // –£–±–∏—Ä–∞–µ–º markdown code blocks
    let cleaned = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
    
    // –ü—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é
    try {
      return JSON.parse(cleaned);
    } catch (e) {
      // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –∏—â–µ–º JSON –≤ —Ç–µ–∫—Å—Ç–µ
      // –ò—â–µ–º —Å —Å–∞–º–æ–π –ø–µ—Ä–≤–æ–π { –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π }
      const firstBrace = cleaned.indexOf('{');
      const lastBrace = cleaned.lastIndexOf('}');
      
      if (firstBrace !== -1 && lastBrace !== -1 && lastBrace > firstBrace) {
        const jsonText = cleaned.substring(firstBrace, lastBrace + 1);
        try {
          return JSON.parse(jsonText);
        } catch (e2) {
          // –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ regex
          const jsonMatch = cleaned.match(/\{[\s\S]*\}/);
          if (jsonMatch) {
            return JSON.parse(jsonMatch[0]);
          }
        }
      }
      
      throw e;
    }
  } catch (error) {
    console.error('Failed to parse JSON. Text was:', text.substring(0, 500));
    throw new Error('Invalid JSON response from AI: ' + error.message);
  }
}

// =============================================================================
// 3-–≠–¢–ê–ü–ù–ê–Ø –í–†–ê–ñ–î–ï–ë–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
// =============================================================================

async function hostileAnalysis(documentText) {
  console.log('üîç –≠–¢–ê–ü 0: –ü–æ–∏—Å–∫ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤...');
  
  let legalData = null;
  
  try {
    const step0Response = await runAssistant(
      `–ù–∞–π–¥–∏ –∏ –∏–∑–≤–ª–µ–∫–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã –∏–∑ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞/—Å–∞–π—Ç–∞:\n\n${documentText}`,
      STEP0_LEGAL_SECTIONS_FINDER
    );
    
    legalData = parseJSON(step0Response);
    console.log(`üìã –ù–∞–π–¥–µ–Ω–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤: ${legalData.foundSections?.length || 0}`);
    console.log(`üì¶ –¢–∏–ø –±–∏–∑–Ω–µ—Å–∞: ${legalData.businessContext?.businessType || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω'}`);
    console.log(`‚ö†Ô∏è –ò—Å–∫–ª—é—á–µ–Ω–∏–π: ${legalData.businessContext?.exceptions?.length || 0}`);
  } catch (error) {
    console.error('‚ö†Ô∏è –û–®–ò–ë–ö–ê –≠–¢–ê–ü–ê 0:', error.message);
    console.log('üìù Fallback: –°–æ–∑–¥–∞—ë–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç');
    
    // Fallback - —Å–æ–∑–¥–∞—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    legalData = {
      foundSections: [],
      businessContext: {
        businessType: '–ù–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω',
        productCategory: '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞',
        specialProperties: [],
        exceptions: []
      },
      recommendedSections: [
        '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã'
      ]
    };
  }
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¢–û–õ–¨–ö–û –∏–∑ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
  let textToCheck = '';
  
  if (legalData.foundSections && legalData.foundSections.length > 0) {
    // –ï—Å—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã - –ø—Ä–æ–≤–µ—Ä—è–µ–º –¢–û–õ–¨–ö–û –∏—Ö
    textToCheck = legalData.foundSections.map(section => 
      `=== ${section.type}: ${section.title} ===\n${section.content}`
    ).join('\n\n');
    console.log('‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º –¢–û–õ–¨–ö–û —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã');
  } else {
    // –ù–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ - –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç –Ω–æ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
    textToCheck = documentText;
    console.log('‚ö†Ô∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç');
  }
  
  console.log('üî¥ –≠–¢–ê–ü 1: –ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –∏—â–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è...');
  
  const step1Response = await runAssistant(
    `–ö–û–ù–¢–ï–ö–°–¢ –ë–ò–ó–ù–ï–°–ê: ${JSON.stringify(legalData.businessContext)}

–ù–ê–ô–î–ï–ù–´ –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ï –†–ê–ó–î–ï–õ–´: ${legalData.foundSections?.map(s => s.type).join(', ') || '–ù–ï–¢'}

–¢–ï–ö–°–¢ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò:
${textToCheck}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –ü—Ä–æ–≤–µ—Ä—è–π –¢–û–õ–¨–ö–û —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –∏ —É—Å–ª–æ–≤–∏—è
2. –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –Ω–∞—Ä—É—à–µ–Ω–∏—è –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ/–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
3. –£—á–∏—Ç—ã–≤–∞–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ businessContext
4. –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –£–ñ–ï –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ ‚Üí –ù–ï–¢ –Ω–∞—Ä—É—à–µ–Ω–∏—è`,
    STEP1_INSPECTOR
  );
  
  const step1Data = parseJSON(step1Response);
  console.log(`–ù–∞–π–¥–µ–Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π: ${step1Data.violations.length}`);
  
  console.log('‚öñÔ∏è –≠–¢–ê–ü 2: –ê–¥–≤–æ–∫–∞—Ç –∏—â–µ—Ç –∑–∞—â–∏—Ç—É...');
  
  const step2Response = await runAssistant(
    `–ö–û–ù–¢–ï–ö–°–¢ –ë–ò–ó–ù–ï–°–ê: ${JSON.stringify(legalData.businessContext)}

–ö–û–ù–¢–ï–ö–°–¢ –î–û–ö–£–ú–ï–ù–¢–ê: ${JSON.stringify(step1Data.context)}

–û–ë–í–ò–ù–ï–ù–ò–Ø: ${JSON.stringify(step1Data.violations)}

‚ö†Ô∏è –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã!`,
    STEP2_LAWYER
  );
  
  const step2Data = parseJSON(step2Response);
  console.log('–ó–∞—â–∏—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞');
  
  console.log('‚öîÔ∏è –≠–¢–ê–ü 3: –°—É–¥—å—è –≤—ã–Ω–æ—Å–∏—Ç –≤–µ—Ä–¥–∏–∫—Ç...');
  
  const step3Response = await runAssistant(
    `–ö–û–ù–¢–ï–ö–°–¢ –ë–ò–ó–ù–ï–°–ê: ${JSON.stringify(legalData.businessContext)}

–ö–û–ù–¢–ï–ö–°–¢ –î–û–ö–£–ú–ï–ù–¢–ê: ${JSON.stringify(step1Data.context)}

–û–ë–í–ò–ù–ï–ù–ò–Ø: ${JSON.stringify(step1Data.violations)}

–ó–ê–©–ò–¢–ê: ${JSON.stringify(step2Data.defenses)}

‚ö†Ô∏è –í–ê–ñ–ù–û: –£—á–∏—Ç—ã–≤–∞–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –≤—ã–Ω–µ—Å–µ–Ω–∏–∏ –≤–µ—Ä–¥–∏–∫—Ç–∞!`,
    STEP3_JUDGE
  );
  
  const verdict = parseJSON(step3Response);
  console.log(`‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π: ${verdict.confirmedViolations.length}`);
  
  // –î–ï–¢–ê–õ–¨–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  if (verdict.confirmedViolations.length > 0) {
    console.log('\nüîç –°–¢–†–£–ö–¢–£–†–ê –ü–ï–†–í–û–ì–û –ù–ê–†–£–®–ï–ù–ò–Ø:');
    console.log(JSON.stringify(verdict.confirmedViolations[0], null, 2));
    console.log('\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è:', Object.keys(verdict.confirmedViolations[0]).join(', '));
  }
  
  return {
    legalSections: legalData.foundSections || [],
    recommendedSections: legalData.recommendedSections || [],
    businessContext: legalData.businessContext,
    context: step1Data.context,
    verdict: verdict
  };
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ (–ø—Ä–µ–º–∏—É–º)
async function generatePremiumTexts(violations) {
  console.log('üíé –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤...');
  
  const userMessage = `üîç –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≥–æ—Ç–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π.

üìö –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –î–ª—è –ö–ê–ñ–î–û–ì–û –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π File Search (Vector Store) —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –¢–û–ß–ù–£–Æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∑–∞–∫–æ–Ω–∞!

‚ö†Ô∏è –ü–†–û –¶–ò–¢–ê–¢–´ –í –ù–ê–†–£–®–ï–ù–ò–Ø–•:
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ü–∏—Ç–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä "–û–§–ï–†–¢–ê: –∏–∫–∞ –ú–æ—Ç–æ...").
–ò–ì–ù–û–†–ò–†–£–ô —Ç–∞–∫–∏–µ —Ü–∏—Ç–∞—Ç—ã! –§–æ–∫—É—Å–∏—Ä—É–π—Å—è –Ω–∞:
- title (–Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è) - —ç—Ç–æ –ì–õ–ê–í–ù–û–ï!
- law (–∫–∞–∫–æ–π –∑–∞–∫–æ–Ω –Ω–∞—Ä—É—à–µ–Ω)
- description (–æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è)

–ò—Å–ø–æ–ª—å–∑—É–π File Search —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ß–¢–û –ò–ú–ï–ù–ù–û –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ –∑–∞–∫–æ–Ω—É!

–ù–ê–†–£–®–ï–ù–ò–Ø (${violations.length} —à—Ç—É–∫):
${JSON.stringify(violations, null, 2)}

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–µ–∫—Å—Ç –¥–ª—è –ö–ê–ñ–î–û–ì–û –Ω–∞—Ä—É—à–µ–Ω–∏—è (–≤—Å–µ–≥–æ ${violations.length})
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π File Search —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–∫–æ–Ω–∞
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–≤–æ–π —Ç–µ–∫—Å—Ç –ü–û–õ–ù–û–°–¢–¨–Æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω—É –∏–∑ Vector Store
4. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π [–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã] - –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π
5. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –∑–∞–∫–æ–Ω—É
6. –ò–ì–ù–û–†–ò–†–£–ô –ø–ª–æ—Ö–∏–µ —Ü–∏—Ç–∞—Ç—ã —Ç–∏–ø–∞ "–û–§–ï–†–¢–ê: –∏–∫–∞ –ú–æ—Ç–æ..." - —ç—Ç–æ –º—É—Å–æ—Ä –æ—Ç –ø–∞—Ä—Å–µ—Ä–∞!`;
  
  const response = await runAssistant(
    userMessage,
    PREMIUM_GENERATOR
  );
  
  return parseJSON(response);
}

// =============================================================================
// –ü–ê–†–°–ò–ù–ì –°–ê–ô–¢–û–í
// =============================================================================

function cleanText(text) {
  return text
    .replace(/[\u0000-\u0008\u000B-\u000C\u000E-\u001F\u007F]/g, '')
    .replace(/[\u2028\u2029]/g, ' ')
    .replace(/\r\n/g, '\n')
    .replace(/\r/g, '\n')
    .trim();
}

async function fetchWebsiteContent(url) {
  return new Promise((resolve, reject) => {
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
      url = 'https://' + url;
    }

    const protocol = url.startsWith('https') ? https : http;
    
    const options = {
      headers: {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
      }
    };
    
    protocol.get(url, options, (res) => {
      let data = '';
      
      if (res.statusCode >= 300 && res.statusCode < 400 && res.headers.location) {
        return fetchWebsiteContent(res.headers.location).then(resolve).catch(reject);
      }
      
      res.on('data', (chunk) => {
        data += chunk;
      });
      
      res.on('end', () => {
        // –£–¥–∞–ª—è–µ–º —Ç–µ–≥–∏ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –º—É—Å–æ—Ä
        let cleaned = data
          // –£–¥–∞–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å—Ç–∏–ª–∏
          .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
          .replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi, '')
          // –£–¥–∞–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
          .replace(/<nav\b[^<]*(?:(?!<\/nav>)<[^<]*)*<\/nav>/gi, '')
          .replace(/<header\b[^<]*(?:(?!<\/header>)<[^<]*)*<\/header>/gi, '')
          // –£–¥–∞–ª—è–µ–º —Ñ—É—Ç–µ—Ä
          .replace(/<footer\b[^<]*(?:(?!<\/footer>)<[^<]*)*<\/footer>/gi, '')
          // –£–¥–∞–ª—è–µ–º –º–µ–Ω—é –∏ —Å–∞–π–¥–±–∞—Ä—ã
          .replace(/<aside\b[^<]*(?:(?!<\/aside>)<[^<]*)*<\/aside>/gi, '')
          .replace(/<div[^>]*class="[^"]*menu[^"]*"[^>]*>.*?<\/div>/gi, '')
          .replace(/<div[^>]*class="[^"]*nav[^"]*"[^>]*>.*?<\/div>/gi, '')
          .replace(/<div[^>]*class="[^"]*sidebar[^"]*"[^>]*>.*?<\/div>/gi, '')
          // –£–¥–∞–ª—è–µ–º —Ä–µ–∫–ª–∞–º—É –∏ –≤–∏–¥–∂–µ—Ç—ã
          .replace(/<div[^>]*class="[^"]*banner[^"]*"[^>]*>.*?<\/div>/gi, '')
          .replace(/<div[^>]*class="[^"]*widget[^"]*"[^>]*>.*?<\/div>/gi, '')
          .replace(/<div[^>]*class="[^"]*ad[^"]*"[^>]*>.*?<\/div>/gi, '');
        
        // –¢–µ–ø–µ—Ä—å —É–±–∏—Ä–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è HTML —Ç–µ–≥–∏
        const text = cleaned
          .replace(/<[^>]+>/g, ' ')
          .replace(/\s+/g, ' ')
          .trim();
        
        // –ò—â–µ–º —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã
        const sections = [];
        
        const offerMatch = text.match(/.{0,500}(–æ—Ñ–µ—Ä—Ç–∞|–ø—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞|–¥–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã|–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ|terms of service|user agreement).{0,5000}/i);
        if (offerMatch) sections.push('–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –†–ê–ó–î–ï–õ - –û–§–ï–†–¢–ê:\n' + offerMatch[0]);
        
        const privacyMatch = text.match(/.{0,500}(–ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏|–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö|–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö|privacy policy).{0,5000}/i);
        if (privacyMatch) sections.push('\n\n–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –†–ê–ó–î–ï–õ - –ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò:\n' + privacyMatch[0]);
        
        const returnMatch = text.match(/.{0,500}(—É—Å–ª–æ–≤–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞|–ø–æ–ª–∏—Ç–∏–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞|–æ–±–º–µ–Ω –∏ –≤–æ–∑–≤—Ä–∞—Ç|refund policy|return policy).{0,3000}/i);
        if (returnMatch) sections.push('\n\n–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –†–ê–ó–î–ï–õ - –í–û–ó–í–†–ê–¢:\n' + returnMatch[0]);
        
        const deliveryMatch = text.match(/.{0,500}(—É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏|–ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏|–¥–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞|shipping policy).{0,3000}/i);
        if (deliveryMatch) sections.push('\n\n–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –†–ê–ó–î–ï–õ - –î–û–°–¢–ê–í–ö–ê:\n' + deliveryMatch[0]);
        
        if (sections.length > 0) {
          console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ ${sections.length} —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –Ω–∞ —Å–∞–π—Ç–µ`);
          resolve(cleanText(sections.join('\n\n')));
        } else {
          console.log('‚ö†Ô∏è –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –±–µ—Ä—ë–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø–µ—Ä–≤—ã–µ 6000 —Å–∏–º–≤–æ–ª–æ–≤)');
          resolve(cleanText('–û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ –°–ê–ô–¢–ê:\n' + text.substring(0, 6000)));
        }
      });
    }).on('error', (err) => {
      reject(err);
    });
  });
}

// =============================================================================
// –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –û–¢–ß–ï–¢–û–í
// =============================================================================

// =============================================================================
// –†–ê–°–ß–Å–¢ –®–¢–†–ê–§–û–í (–ù–ê BACKEND, –ù–ï –î–û–í–ï–†–Ø–ï–ú AI!)
// =============================================================================

// –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —à—Ç—Ä–∞—Ñ–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
// =============================================================================
// –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –°–û –®–¢–†–ê–§–ê–ú–ò
// =============================================================================

// –ü–æ–ª—É—á–∏—Ç—å —à—Ç—Ä–∞—Ñ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∑–∞–∫–æ–Ω—É –∏ —Ç–∏–ø—É –Ω–∞—Ä—É—à–µ–Ω–∏—è
function getFineFromTable(law, violationType, violationTitle) {
  console.log(`üîç –ò—â—É —à—Ç—Ä–∞—Ñ –¥–ª—è: –∑–∞–∫–æ–Ω="${law}", —Ç–∏–ø="${violationType}", title="${violationTitle}"`);
  
  // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–æ–Ω–∞
  let normalizedLaw = law;
  if (law.includes('152') || law.toLowerCase().includes('–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω')) {
    normalizedLaw = '–§–ó-152';
  } else if (law.includes('–ó–æ–ó–ü–ü') || law.toLowerCase().includes('–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª')) {
    normalizedLaw = '–ó–æ–ó–ü–ü';
  } else if (law.includes('38') || law.toLowerCase().includes('—Ä–µ–∫–ª–∞–º')) {
    normalizedLaw = '–§–ó-38';
  }
  
  const lawFines = FINES_TABLE[normalizedLaw];
  if (!lawFines) {
    console.log(`‚ö†Ô∏è –ó–∞–∫–æ–Ω "${normalizedLaw}" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ, –∏—Å–ø–æ–ª—å–∑—É—é –¥–µ—Ñ–æ–ª—Ç`);
    return { ip: { min: 10000, max: 50000 }, ooo: { min: 100000, max: 500000 } };
  }
  
  // –ò—â–µ–º –ø–æ –≤—Å–µ–º —Ç–µ–∫—Å—Ç–∞–º (—Ç–∏–ø, title, –æ–ø–∏—Å–∞–Ω–∏–µ)
  const searchText = `${violationType} ${violationTitle}`.toLowerCase();
  const violationKey = Object.keys(lawFines).find(key => 
    searchText.includes(key.toLowerCase()) || key.toLowerCase().includes(violationType.toLowerCase())
  );
  
  const fine = lawFines[violationKey] || lawFines['default'];
  console.log(`‚úÖ –ù–∞–π–¥–µ–Ω —à—Ç—Ä–∞—Ñ:`, fine);
  
  return fine;
}

// –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —à—Ç—Ä–∞—Ñ–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–†–ï–ó–ï–†–í–ù–ê–Ø, –µ—Å–ª–∏ AI –≤–µ—Ä–Ω—ë—Ç —à—Ç—Ä–∞—Ñ—ã)
function parseFine(fineStr) {
  // "–æ—Ç 10,000‚ÇΩ –¥–æ 50,000‚ÇΩ" –∏–ª–∏ "–¥–æ 50,000‚ÇΩ"
  if (!fineStr) return { min: 0, max: 0 };
  
  const numbers = fineStr.match(/[\d,]+/g);
  if (!numbers) return { min: 0, max: 0 };
  
  const parsed = numbers.map(n => parseInt(n.replace(/,/g, '')));
  
  if (parsed.length === 1) {
    // "–¥–æ 50,000‚ÇΩ"
    return { min: 0, max: parsed[0] };
  } else if (parsed.length >= 2) {
    // "–æ—Ç 10,000‚ÇΩ –¥–æ 50,000‚ÇΩ"
    return { min: parsed[0], max: parsed[1] };
  }
  
  return { min: 0, max: 0 };
}

// –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ —Å—É–º–º–∞—Ä–Ω—ã—Ö —à—Ç—Ä–∞—Ñ–æ–≤
function calculateTotalRisk(violations) {
  let totalMinIP = 0;
  let totalMaxIP = 0;
  let totalMinOOO = 0;
  let totalMaxOOO = 0;
  
  console.log('üìä –†–∞—Å—á—ë—Ç —Å—É–º–º–∞—Ä–Ω—ã—Ö —à—Ç—Ä–∞—Ñ–æ–≤:');
  
  violations.forEach((v, index) => {
    // –ò–°–ü–û–õ–¨–ó–£–ï–ú –¢–ê–ë–õ–ò–¶–£ –®–¢–†–ê–§–û–í –≤–º–µ—Å—Ç–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ AI –æ—Ç–≤–µ—Ç–∞
    const fine = getFineFromTable(
      v.law || '', 
      v.type || v.category || '', 
      v.title || v.description || ''
    );
    
    console.log(`  –ù–∞—Ä—É—à–µ–Ω–∏–µ ${index + 1}: ${v.title || v.description}`);
    console.log(`    –ó–∞–∫–æ–Ω: ${v.law}`);
    console.log(`    –ò–ü: –æ—Ç ${fine.ip.min} –¥–æ ${fine.ip.max}`);
    console.log(`    –û–û–û: –æ—Ç ${fine.ooo.min} –¥–æ ${fine.ooo.max}`);
    
    totalMinIP += fine.ip.min;
    totalMaxIP += fine.ip.max;
    totalMinOOO += fine.ooo.min;
    totalMaxOOO += fine.ooo.max;
  });
  
  console.log(`  üí∞ –ò–¢–û–ì–û:`);
  console.log(`    –ò–ü: –æ—Ç ${totalMinIP} –¥–æ ${totalMaxIP}`);
  console.log(`    –û–û–û: –æ—Ç ${totalMinOOO} –¥–æ ${totalMaxOOO}`);
  
  const formatNumber = (num) => {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  };
  
  return {
    ip: `–æ—Ç ${formatNumber(totalMinIP)}‚ÇΩ –¥–æ ${formatNumber(totalMaxIP)}‚ÇΩ`,
    ooo: `–æ—Ç ${formatNumber(totalMinOOO)}‚ÇΩ –¥–æ ${formatNumber(totalMaxOOO)}‚ÇΩ`
  };
}

// =============================================================================
// –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –û–¢–ß–ï–¢–û–í
// =============================================================================

function formatFreeReport(analysis) {
  const violations = analysis.verdict.confirmedViolations;
  
  const critical = violations.filter(v => v.category === 'üî¥').length;
  const high = violations.filter(v => v.category === 'üü°').length;
  const medium = violations.filter(v => v.category === 'üü¢').length;
  
  // –°–ß–ò–¢–ê–ï–ú –°–£–ú–ú–´ –°–ê–ú–ò –ù–ê BACKEND! –ù–ï –î–û–í–ï–†–Ø–ï–ú AI –° –ú–ê–¢–ï–ú–ê–¢–ò–ö–û–ô!
  const totalRisk = calculateTotalRisk(violations);
  
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º
  const checkedSections = [];
  const missingSections = [];
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã
  if (analysis.legalSections && analysis.legalSections.length > 0) {
    analysis.legalSections.forEach(section => {
      const sectionViolations = violations.map((v, index) => ({
        id: index + 1,
        title: v.title || v.description || '–ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞',
        category: v.category,
        fineIP: v.fineIP || '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è',
        fineOOO: v.fineOOO || '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è'
      }));
      
      checkedSections.push({
        type: section.type,
        title: section.title,
        source: section.source || '–ù–∞–π–¥–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ',
        violations: sectionViolations
      });
    });
  } else {
    // –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ –æ–¥–∏–Ω
    const allViolations = violations.map((v, index) => ({
      id: index + 1,
      title: v.title || v.description || '–ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞',
      category: v.category,
      fineIP: v.fineIP || '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è',
      fineOOO: v.fineOOO || '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è'
    }));
    
    checkedSections.push({
      type: 'Document',
      title: '–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç',
      source: '–í–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç',
      violations: allViolations
    });
  }
  
  // –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
  if (analysis.recommendedSections && analysis.recommendedSections.length > 0) {
    analysis.recommendedSections.forEach(rec => {
      // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–¥–µ–ª–µ
      let sectionInfo = null;
      
      // –ò—â–µ–º –ø–æ —Ç–∏–ø—É —Ä–∞–∑–¥–µ–ª–∞ –≤ LEGAL_SECTIONS_INFO
      for (const [key, info] of Object.entries(LEGAL_SECTIONS_INFO)) {
        if (rec.toLowerCase().includes(info.nameRu.toLowerCase()) ||
            rec.toLowerCase().includes(key.toLowerCase())) {
          sectionInfo = { ...info, type: key };
          break;
        }
      }
      
      if (sectionInfo) {
        const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        
        missingSections.push({
          title: sectionInfo.nameRu,
          type: sectionInfo.type,
          requiredBy: sectionInfo.requiredBy,
          hasFine: sectionInfo.hasFine,
          fineIP: sectionInfo.hasFine ? 
            `–æ—Ç ${formatNumber(sectionInfo.fineForMissing.ip.min)}‚ÇΩ –¥–æ ${formatNumber(sectionInfo.fineForMissing.ip.max)}‚ÇΩ` : 
            null,
          fineOOO: sectionInfo.hasFine ? 
            `–æ—Ç ${formatNumber(sectionInfo.fineForMissing.ooo.min)}‚ÇΩ –¥–æ ${formatNumber(sectionInfo.fineForMissing.ooo.max)}‚ÇΩ` : 
            null,
          risk: sectionInfo.risk || null,
          generationPrice: sectionInfo.generationPrice,
          recommended: true
        });
      } else {
        // Fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
        missingSections.push({
          title: rec,
          recommended: true,
          generationPrice: 1490
        });
      }
    });
  }
  
  return {
    found: violations.length,
    riskIP: totalRisk.ip,
    riskOOO: totalRisk.ooo,
    level: critical > 0 ? '–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô' : high > 0 ? '–í–´–°–û–ö–ò–ô' : '–°–†–ï–î–ù–ò–ô',
    breakdown: {
      critical,
      high,
      medium
    },
    checkedSections: checkedSections,
    missingSections: missingSections,
    packages: DOCUMENT_GENERATION_PACKAGES,
    upgradePrompt: '–û–ø–ª–∞—Ç–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –∑–∞ 1,990‚ÇΩ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ü–∏—Ç–∞—Ç—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞, —Å—Ç–∞—Ç—å–∏ –∑–∞–∫–æ–Ω–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏'
  };
}

function formatBasicReport(analysis) {
  console.log('\nüìã –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ë–ê–ó–û–í–û–ì–û –û–¢–ß–Å–¢–ê...');
  console.log(`–ù–∞—Ä—É—à–µ–Ω–∏–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${analysis.verdict.confirmedViolations.length}`);
  
  // –°–ß–ò–¢–ê–ï–ú –°–£–ú–ú–´ –°–ê–ú–ò –ù–ê BACKEND!
  const totalRisk = calculateTotalRisk(analysis.verdict.confirmedViolations);
  
  // –î–æ–±–∞–≤–ª—è–µ–º —à—Ç—Ä–∞—Ñ—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ –∫–∞–∂–¥–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ
  const violationsWithFines = analysis.verdict.confirmedViolations.map((v, index) => {
    console.log(`\n  –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—Ä—É—à–µ–Ω–∏—è ${index + 1}:`);
    console.log(`    law: "${v.law}"`);
    console.log(`    type: "${v.type}"`);
    console.log(`    category: "${v.category}"`);
    console.log(`    title: "${v.title}" (typeof: ${typeof v.title})`);
    console.log(`    description: "${v.description}" (typeof: ${typeof v.description})`);
    
    // –§–ò–ö–°: Fallback –µ—Å–ª–∏ AI –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª title –∏–ª–∏ –≤–µ—Ä–Ω—É–ª —Å—Ç—Ä–æ–∫—É "undefined"
    const isValidString = (str) => str && str !== "undefined" && str.trim() !== "";
    
    const displayTitle = isValidString(v.title) 
      ? v.title 
      : isValidString(v.description)
        ? v.description
        : '–ù–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞';
    
    const displayDescription = isValidString(v.description) 
      ? v.description 
      : isValidString(v.title)
        ? v.title
        : '';
    
    console.log(`    üîß –ü–æ—Å–ª–µ fallback: title="${displayTitle}", description="${displayDescription}"`);
    
    const fine = getFineFromTable(
      v.law || '', 
      v.type || v.category || '', 
      displayTitle
    );
    
    const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    
    const result = {
      ...v,
      title: displayTitle,  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —á—Ç–æ title –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å
      description: displayDescription,
      fineIP: `–æ—Ç ${formatNumber(fine.ip.min)}‚ÇΩ –¥–æ ${formatNumber(fine.ip.max)}‚ÇΩ`,
      fineOOO: `–æ—Ç ${formatNumber(fine.ooo.min)}‚ÇΩ –¥–æ ${formatNumber(fine.ooo.max)}‚ÇΩ`
    };
    
    console.log(`    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —à—Ç—Ä–∞—Ñ—ã: –ò–ü=${result.fineIP}, –û–û–û=${result.fineOOO}`);
    
    return result;
  });
  
  console.log(`\nüìä –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–∏—Å–∫–∏: –ò–ü=${totalRisk.ip}, –û–û–û=${totalRisk.ooo}\n`);
  
  return {
    context: analysis.context,
    violations: violationsWithFines,
    rejected: analysis.verdict.rejectedViolations,
    totalRiskIP: totalRisk.ip,
    totalRiskOOO: totalRisk.ooo,
    checkedSections: analysis.legalSections || [],
    missingSections: analysis.recommendedSections || [],
    timestamp: new Date().toISOString(),
    version: 'AI –Æ—Ä–∏—Å—Ç –†–§ v2.0',
    upgradePrompt: '–ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞ +800‚ÇΩ (–ø—Ä–µ–º–∏—É–º-–≤–µ—Ä—Å–∏—è)'
  };
}

async function formatPremiumReport(analysis) {
  try {
    const violationsCount = analysis.verdict.confirmedViolations.length;
    console.log(`üìä –ù–∞—Ä—É—à–µ–Ω–∏–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${violationsCount}`);
    
    const premiumTexts = await generatePremiumTexts(analysis.verdict.confirmedViolations);
    
    console.log(`‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤: ${premiumTexts.readyTexts?.length || 0}`);
    
    if (!premiumTexts.readyTexts || premiumTexts.readyTexts.length !== violationsCount) {
      console.warn(`‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –û–∂–∏–¥–∞–ª–æ—Å—å ${violationsCount} —Ç–µ–∫—Å—Ç–æ–≤, –ø–æ–ª—É—á–µ–Ω–æ ${premiumTexts.readyTexts?.length || 0}`);
    }
    
    // üîÑ –ù–û–í–û–ï: –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤ –¥–æ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    console.log('üîÑ –ó–∞–ø—É—Å–∫ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤...');
    
    const violationsWithTexts = [];
    
    for (let i = 0; i < analysis.verdict.confirmedViolations.length; i++) {
      const v = analysis.verdict.confirmedViolations[i];
      const readyTextObj = premiumTexts.readyTexts?.[i];
      
      if (!readyTextObj) {
        console.warn(`‚ö†Ô∏è –ù–µ—Ç –≥–æ—Ç–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –Ω–∞—Ä—É—à–µ–Ω–∏—è ${i + 1}: ${v.title}`);
        violationsWithTexts.push({
          ...v,
          readyText: null,
          insertLocation: null
        });
        continue;
      }
      
      let generatedText = typeof readyTextObj === 'object' ? readyTextObj.template : readyTextObj;
      const insertLocation = typeof readyTextObj === 'object' ? readyTextObj.location : null;
      
      // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ (–º–∞–∫—Å–∏–º—É–º 3 –∏—Ç–µ—Ä–∞—Ü–∏–∏)
      let iteration = 0;
      const maxIterations = 3;
      let isTextClean = false;
      
      while (iteration < maxIterations && !isTextClean) {
        iteration++;
        console.log(`   –ò—Ç–µ—Ä–∞—Ü–∏—è ${iteration}/${maxIterations} –¥–ª—è –Ω–∞—Ä—É—à–µ–Ω–∏—è ${i + 1}...`);
        
        try {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ –≤—Å–µ 3 —ç—Ç–∞–ø–∞
          const checkResponse = await runAssistant(
            `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${generatedText}`,
            STEP1_INSPECTOR
          );
          const checkResult = parseJSON(checkResponse);
          
          if (!checkResult.violations || checkResult.violations.length === 0) {
            console.log(`   ‚úÖ –¢–µ–∫—Å—Ç –∏–¥–µ–∞–ª–µ–Ω! –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.`);
            isTextClean = true;
            break;
          }
          
          // –ü—Ä–æ–≥–æ–Ω—è–µ–º —á–µ—Ä–µ–∑ –∞–¥–≤–æ–∫–∞—Ç–∞ –∏ —Å—É–¥—å—é
          const lawyerResponse = await runAssistant(
            `–ö–û–ù–¢–ï–ö–°–¢: ${JSON.stringify(checkResult.context)}\n\n–û–ë–í–ò–ù–ï–ù–ò–Ø: ${JSON.stringify(checkResult.violations)}`,
            STEP2_LAWYER
          );
          const lawyerData = parseJSON(lawyerResponse);
          
          const judgeResponse = await runAssistant(
            `–ö–û–ù–¢–ï–ö–°–¢: ${JSON.stringify(checkResult.context)}\n\n–û–ë–í–ò–ù–ï–ù–ò–Ø: ${JSON.stringify(checkResult.violations)}\n\n–ó–ê–©–ò–¢–ê: ${JSON.stringify(lawyerData.defenses)}`,
            STEP3_JUDGE
          );
          const verdict = parseJSON(judgeResponse);
          
          // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Ä—É—à–µ–Ω–∏—è –°–û –®–¢–†–ê–§–ê–ú–ò
          const violationsWithFines = verdict.confirmedViolations?.filter(v => 
            (v.fineIP && v.fineIP !== '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è') || 
            (v.fineOOO && v.fineOOO !== '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è')
          ) || [];
          
          if (violationsWithFines.length === 0) {
            console.log(`   ‚úÖ –¢–µ–∫—Å—Ç —á–∏—Å—Ç! (${verdict.confirmedViolations?.length || 0} –Ω–∞—Ä—É—à–µ–Ω–∏–π –±–µ–∑ —à—Ç—Ä–∞—Ñ–æ–≤)`);
            isTextClean = true;
            break;
          }
          
          console.log(`   üîß –ù–∞–π–¥–µ–Ω–æ ${violationsWithFines.length} —à—Ç—Ä–∞—Ñ—É–µ–º—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π, —É–ª—É—á—à–∞—é —Ç–µ–∫—Å—Ç...`);
          
          // –ü—Ä–æ—Å–∏–º AI —É–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç
          const improvePrompt = `üîß –£–õ–£–ß–®–ò –≠–¢–û–¢ –¢–ï–ö–°–¢

–¢–ï–ö–£–©–ò–ô –¢–ï–ö–°–¢:
${generatedText}

–ü–†–û–ë–õ–ï–ú–´ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã):
${violationsWithFines.map((vf, idx) => `${idx + 1}. ${vf.title} - ${vf.quote || vf.description}`).join('\n')}

üìö –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π File Search (Vector Store) –¥–ª—è –ø–æ–∏—Å–∫–∞ –¢–û–ß–ù–´–• —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫!

–ó–ê–î–ê–ß–ê:
1. –ò—Å–ø–æ–ª—å–∑—É–π File Search —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–Ω–∞
2. –î–æ–±–∞–≤—å –í–°–ï –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Å—Ä–æ–∫, —Å–ø–æ—Å–æ–± –æ—Ç–∑—ã–≤–∞, —Ä–µ–∫–≤–∏–∑–∏—Ç—ã, —Ü–µ–ª—å, –ø–µ—Ä–µ—á–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–¥.)
3. –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–µ–∫—Å—Ç –ü–û–õ–ù–û–°–¢–¨–Æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫–æ–Ω—É
4. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≥–æ—Ç–æ–≤—ã–π —É–ª—É—á—à–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –ë–ï–ó –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
5. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π [–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã] - —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç, –±–µ–∑ JSON, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π!`;
          
          const improvedResponse = await runAssistant(
            improvePrompt,
            '–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —É–ª—É—á—à–∏—Ç—å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç —á—Ç–æ–±—ã –æ–Ω –ü–û–õ–ù–û–°–¢–¨–Æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –∑–∞–∫–æ–Ω—É.'
          );
          
          generatedText = improvedResponse.trim();
          console.log(`   ‚úÖ –¢–µ–∫—Å—Ç —É–ª—É—á—à–µ–Ω (${generatedText.length} —Å–∏–º–≤–æ–ª–æ–≤)`);
          
        } catch (improveError) {
          console.error(`   ‚ùå –û—à–∏–±–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è:`, improveError.message);
          break;
        }
      }
      
      if (iteration >= maxIterations && !isTextClean) {
        console.warn(`   ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π (${maxIterations}), —Ç–µ–∫—Å—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∏–¥–µ–∞–ª–µ–Ω`);
      }
      
      violationsWithTexts.push({
        ...v,
        readyText: generatedText,
        insertLocation: insertLocation
      });
    }
    
    console.log('‚úÖ –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    
    return {
      ...formatBasicReport(analysis),
      violations: violationsWithTexts
    };
  } catch (error) {
    console.error('‚ö†Ô∏è –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤:', error.message);
    
    // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—ã–π –æ—Ç—á—ë—Ç –±–µ–∑ –≥–æ—Ç–æ–≤—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤
    return formatBasicReport(analysis);
  }
}

// =============================================================================
// ENDPOINTS
// =============================================================================

app.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    version: '2.0.0',
    assistantConfigured: !!ASSISTANT_ID,
    timestamp: new Date().toISOString()
  });
});

// –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —ç–∫—Å–ø—Ä–µ—Å—Å-–ø—Ä–æ–≤–µ—Ä–∫–∞
app.post('/api/check-free', async (req, res) => {
  try {
    let { text } = req.body;
    
    if (!text) {
      return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
    }
    
    console.log('[FREE] –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏');
    
    let sourceUrl = null;
    
    // –ü–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if (text.startsWith('URL: ')) {
      sourceUrl = text.replace('URL: ', '').trim();
      text = await fetchWebsiteContent(sourceUrl);
    }
    
    text = cleanText(text);
    
    // –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    const analysis = await hostileAnalysis(text);
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–∫—É—é –≤–µ—Ä—Å–∏—é
    const freeReport = formatFreeReport(analysis);
    
    res.json({
      success: true,
      tier: 'free',
      data: {
        ...freeReport,
        sourceUrl: sourceUrl || '–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç',
        documentType: sourceUrl ? 'website' : 'text'
      }
    });
    
  } catch (error) {
    console.error('[FREE] Error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (1,990‚ÇΩ)
app.post('/api/check-basic', async (req, res) => {
  try {
    let { text, paymentId } = req.body;
    
    if (!text) {
      return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
    }
    
    // TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ paymentId
    
    console.log('[BASIC] –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏');
    
    let sourceUrl = null;
    
    if (text.startsWith('URL: ')) {
      sourceUrl = text.replace('URL: ', '').trim();
      text = await fetchWebsiteContent(sourceUrl);
    }
    
    text = cleanText(text);
    
    const analysis = await hostileAnalysis(text);
    const basicReport = formatBasicReport(analysis);
    
    res.json({
      success: true,
      tier: 'basic',
      data: {
        ...basicReport,
        sourceUrl: sourceUrl || '–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç',
        documentType: sourceUrl ? 'website' : 'text'
      }
    });
    
  } catch (error) {
    console.error('[BASIC] Error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// –ü—Ä–µ–º–∏—É–º –ø—Ä–æ–≤–µ—Ä–∫–∞ (2,790‚ÇΩ)
app.post('/api/check-premium', async (req, res) => {
  try {
    let { text, paymentId } = req.body;
    
    if (!text) {
      return res.status(400).json({ error: '–¢–µ–∫—Å—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω' });
    }
    
    // TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ paymentId
    
    console.log('[PREMIUM] –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏');
    
    if (text.startsWith('URL: ')) {
      const url = text.replace('URL: ', '').trim();
      text = await fetchWebsiteContent(url);
    }
    
    text = cleanText(text);
    
    const analysis = await hostileAnalysis(text);
    const premiumReport = await formatPremiumReport(analysis);
    
    res.json({
      success: true,
      tier: 'premium',
      data: premiumReport
    });
    
  } catch (error) {
    console.error('[PREMIUM] Error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// =============================================================================
// ENDPOINT: –ì–ï–ù–ï–†–ê–¶–ò–Ø –Æ–†–ò–î–ò–ß–ï–°–ö–ò–• –î–û–ö–£–ú–ï–ù–¢–û–í
// =============================================================================

app.post('/api/generate-documents', async (req, res) => {
  try {
    const { documentTypes, paymentId } = req.body;
    
    if (!documentTypes || !Array.isArray(documentTypes) || documentTypes.length === 0) {
      return res.status(400).json({ error: '–£–∫–∞–∂–∏—Ç–µ —Ç–∏–ø—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏' });
    }
    
    // TODO: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ paymentId
    
    console.log(`[GENERATE] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${documentTypes.join(', ')}`);
    
    const generatedDocuments = [];
    
    for (const docType of documentTypes) {
      const sectionInfo = LEGAL_SECTIONS_INFO[docType];
      
      if (!sectionInfo) {
        console.warn(`–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${docType}`);
        continue;
      }
      
      console.log(`  –ì–µ–Ω–µ—Ä–∏—Ä—É—é: ${sectionInfo.nameRu}...`);
      
      const prompt = `üîß –°–û–ó–î–ê–ô –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –î–û–ö–£–ú–ï–ù–¢

–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞: ${sectionInfo.nameRu}
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è: ${sectionInfo.requiredBy}

üìö –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π File Search (Vector Store) —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –í–°–ï —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–∫–æ–Ω–∞!

‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ü–û–õ–ù–û–°–¢–¨–Æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§ 2025 –≥–æ–¥–∞
2. –ò—Å–ø–æ–ª—å–∑—É–π File Search –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ—á–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫
3. –ò—Å–ø–æ–ª—å–∑—É–π –ü–õ–ï–ô–°–•–û–õ–î–ï–†–´ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏:
   - [–ù–ê–ó–í–ê–ù–ò–ï –ö–û–ú–ü–ê–ù–ò–ò]
   - [–ò–ù–ù]
   - [–û–ì–†–ù]
   - [–Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –ê–î–†–ï–°]
   - [–¢–ï–õ–ï–§–û–ù]
   - [EMAIL]
   - [URL –°–ê–ô–¢–ê]
   - –∏ —Ç.–¥.
4. –î–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
5. –í–∫–ª—é—á–∏ –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –ø–æ –∑–∞–∫–æ–Ω—É
6. –§–æ—Ä–º–∞—Ç: –ß–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.`;
      
      const documentText = await runAssistant(prompt, PREMIUM_GENERATOR);
      
      generatedDocuments.push({
        type: docType,
        name: sectionInfo.nameRu,
        content: documentText,
        timestamp: new Date().toISOString()
      });
    }
    
    res.json({
      success: true,
      documents: generatedDocuments,
      totalPrice: documentTypes.length * 1490,
      message: '–î–æ–∫—É–º–µ–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã'
    });
    
  } catch (error) {
    console.error('[GENERATE] Error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// =============================================================================
// –ó–ê–ü–£–°–ö
// =============================================================================

app.listen(PORT, () => {
  console.log(`üöÄ AI Lawyer API v2.0 –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
  console.log(`üîë OpenAI API: ${process.env.OPENAI_API_KEY ? '‚úÖ' : '‚ùå'}`);
  console.log(`ü§ñ Assistant ID: ${ASSISTANT_ID ? '‚úÖ ' + ASSISTANT_ID : '‚ùå'}`);
  console.log(`‚úÖ –í—Ä–∞–∂–¥–µ–±–Ω–∞—è 3-—ç—Ç–∞–ø–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞!`);
});
